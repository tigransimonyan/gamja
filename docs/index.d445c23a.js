function e(e,t,s,n){Object.defineProperty(e,t,{get:s,set:n,enumerable:!0,configurable:!0})}var t,s,n,r,a,i,u={},o=[],l=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function c(e,t){for(var s in t)e[s]=t[s];return e}function h(e){var t=e.parentNode;t&&t.removeChild(e)}function p(e,s,n){var r,a,i,u={};for(i in s)"key"==i?r=s[i]:"ref"==i?a=s[i]:u[i]=s[i];if(arguments.length>2&&(u.children=arguments.length>3?t.call(arguments,2):n),"function"==typeof e&&null!=e.defaultProps)for(i in e.defaultProps)void 0===u[i]&&(u[i]=e.defaultProps[i]);return m(e,u,r,a,null)}function m(e,t,r,a,i){var u={type:e,props:t,key:r,ref:a,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==i?++n:i};return null==i&&null!=s.vnode&&s.vnode(u),u}function d(e){return e.children}function f(e,t){this.props=e,this.context=t}function D(e,t){if(null==t)return e.__?D(e.__,e.__.__k.indexOf(e)+1):null;for(var s;t<e.__k.length;t++)if(null!=(s=e.__k[t])&&null!=s.__e)return s.__e;return"function"==typeof e.type?D(e):null}function g(e){var t,s;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(s=e.__k[t])&&null!=s.__e){e.__e=e.__c.base=s.__e;break}return g(e)}}function b(e){(!e.__d&&(e.__d=!0)&&r.push(e)&&!C.__r++||i!==s.debounceRendering)&&((i=s.debounceRendering)||a)(C)}function C(){for(var e;C.__r=r.length;)e=r.sort((function(e,t){return e.__v.__b-t.__v.__b})),r=[],e.some((function(e){var t,s,n,r,a,i;e.__d&&(a=(r=(t=e).__v).__e,(i=t.__P)&&(s=[],(n=c({},r)).__v=r.__v+1,F(i,r,n,t.__n,void 0!==i.ownerSVGElement,null!=r.__h?[a]:null,s,null==a?D(r):a,r.__h),N(s,r),r.__e!=a&&g(r)))}))}function E(e,t,s,n,r,a,i,l,c,h){var p,f,g,b,C,E,A,w=n&&n.__k||o,y=w.length;for(s.__k=[],p=0;p<t.length;p++)if(null!=(b=s.__k[p]=null==(b=t[p])||"boolean"==typeof b?null:"string"==typeof b||"number"==typeof b||"bigint"==typeof b?m(null,b,null,null,b):Array.isArray(b)?m(d,{children:b},null,null,null):b.__b>0?m(b.type,b.props,b.key,null,b.__v):b)){if(b.__=s,b.__b=s.__b+1,null===(g=w[p])||g&&b.key==g.key&&b.type===g.type)w[p]=void 0;else for(f=0;f<y;f++){if((g=w[f])&&b.key==g.key&&b.type===g.type){w[f]=void 0;break}g=null}F(e,b,g=g||u,r,a,i,l,c,h),C=b.__e,(f=b.ref)&&g.ref!=f&&(A||(A=[]),g.ref&&A.push(g.ref,null,b),A.push(f,b.__c||C,b)),null!=C?(null==E&&(E=C),"function"==typeof b.type&&b.__k===g.__k?b.__d=c=v(b,c,e):c=k(e,b,g,w,C,c),"function"==typeof s.type&&(s.__d=c)):c&&g.__e==c&&c.parentNode!=e&&(c=D(g))}for(s.__e=E,p=y;p--;)null!=w[p]&&("function"==typeof s.type&&null!=w[p].__e&&w[p].__e==s.__d&&(s.__d=D(n,p+1)),O(w[p],w[p]));if(A)for(p=0;p<A.length;p++)B(A[p],A[++p],A[++p])}function v(e,t,s){for(var n,r=e.__k,a=0;r&&a<r.length;a++)(n=r[a])&&(n.__=e,t="function"==typeof n.type?v(n,t,s):k(s,n,n,r,n.__e,t));return t}function k(e,t,s,n,r,a){var i,u,o;if(void 0!==t.__d)i=t.__d,t.__d=void 0;else if(null==s||r!=a||null==r.parentNode)e:if(null==a||a.parentNode!==e)e.appendChild(r),i=null;else{for(u=a,o=0;(u=u.nextSibling)&&o<n.length;o+=2)if(u==r)break e;e.insertBefore(r,a),i=a}return void 0!==i?i:r.nextSibling}function A(e,t,s){"-"===t[0]?e.setProperty(t,s):e[t]=null==s?"":"number"!=typeof s||l.test(t)?s:s+"px"}function w(e,t,s,n,r){var a;e:if("style"===t)if("string"==typeof s)e.style.cssText=s;else{if("string"==typeof n&&(e.style.cssText=n=""),n)for(t in n)s&&t in s||A(e.style,t,"");if(s)for(t in s)n&&s[t]===n[t]||A(e.style,t,s[t])}else if("o"===t[0]&&"n"===t[1])a=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+a]=s,s?n||e.addEventListener(t,a?S:y,a):e.removeEventListener(t,a?S:y,a);else if("dangerouslySetInnerHTML"!==t){if(r)t=t.replace(/xlink[H:h]/,"h").replace(/sName$/,"s");else if("href"!==t&&"list"!==t&&"form"!==t&&"tabIndex"!==t&&"download"!==t&&t in e)try{e[t]=null==s?"":s;break e}catch(e){}"function"==typeof s||(null!=s&&(!1!==s||"a"===t[0]&&"r"===t[1])?e.setAttribute(t,s):e.removeAttribute(t))}}function y(e){this.l[e.type+!1](s.event?s.event(e):e)}function S(e){this.l[e.type+!0](s.event?s.event(e):e)}function F(e,n,r,a,i,o,l,p,m){var g,b,C,v,k,A,y,S,F,N,B,O=n.type;if(void 0!==n.constructor)return null;null!=r.__h&&(m=r.__h,p=n.__e=r.__e,n.__h=null,o=[p]),(g=s.__b)&&g(n);try{e:if("function"==typeof O){if(S=n.props,F=(g=O.contextType)&&a[g.__c],N=g?F?F.props.value:g.__:a,r.__c?y=(b=n.__c=r.__c).__=b.__E:("prototype"in O&&O.prototype.render?n.__c=b=new O(S,N):(n.__c=b=new f(S,N),b.constructor=O,b.render=_),F&&F.sub(b),b.props=S,b.state||(b.state={}),b.context=N,b.__n=a,C=b.__d=!0,b.__h=[]),null==b.__s&&(b.__s=b.state),null!=O.getDerivedStateFromProps&&(b.__s==b.state&&(b.__s=c({},b.__s)),c(b.__s,O.getDerivedStateFromProps(S,b.__s))),v=b.props,k=b.state,C)null==O.getDerivedStateFromProps&&null!=b.componentWillMount&&b.componentWillMount(),null!=b.componentDidMount&&b.__h.push(b.componentDidMount);else{if(null==O.getDerivedStateFromProps&&S!==v&&null!=b.componentWillReceiveProps&&b.componentWillReceiveProps(S,N),!b.__e&&null!=b.shouldComponentUpdate&&!1===b.shouldComponentUpdate(S,b.__s,N)||n.__v===r.__v){b.props=S,b.state=b.__s,n.__v!==r.__v&&(b.__d=!1),b.__v=n,n.__e=r.__e,n.__k=r.__k,n.__k.forEach((function(e){e&&(e.__=n)})),b.__h.length&&l.push(b);break e}null!=b.componentWillUpdate&&b.componentWillUpdate(S,b.__s,N),null!=b.componentDidUpdate&&b.__h.push((function(){b.componentDidUpdate(v,k,A)}))}b.context=N,b.props=S,b.state=b.__s,(g=s.__r)&&g(n),b.__d=!1,b.__v=n,b.__P=e,g=b.render(b.props,b.state,b.context),b.state=b.__s,null!=b.getChildContext&&(a=c(c({},a),b.getChildContext())),C||null==b.getSnapshotBeforeUpdate||(A=b.getSnapshotBeforeUpdate(v,k)),B=null!=g&&g.type===d&&null==g.key?g.props.children:g,E(e,Array.isArray(B)?B:[B],n,r,a,i,o,l,p,m),b.base=n.__e,n.__h=null,b.__h.length&&l.push(b),y&&(b.__E=b.__=null),b.__e=!1}else null==o&&n.__v===r.__v?(n.__k=r.__k,n.__e=r.__e):n.__e=function(e,s,n,r,a,i,o,l){var c,p,m,d=n.props,f=s.props,g=s.type,b=0;if("svg"===g&&(a=!0),null!=i)for(;b<i.length;b++)if((c=i[b])&&(c===e||(g?c.localName==g:3==c.nodeType))){e=c,i[b]=null;break}if(null==e){if(null===g)return document.createTextNode(f);e=a?document.createElementNS("http://www.w3.org/2000/svg",g):document.createElement(g,f.is&&f),i=null,l=!1}if(null===g)d===f||l&&e.data===f||(e.data=f);else{if(i=i&&t.call(e.childNodes),p=(d=n.props||u).dangerouslySetInnerHTML,m=f.dangerouslySetInnerHTML,!l){if(null!=i)for(d={},b=0;b<e.attributes.length;b++)d[e.attributes[b].name]=e.attributes[b].value;(m||p)&&(m&&(p&&m.__html==p.__html||m.__html===e.innerHTML)||(e.innerHTML=m&&m.__html||""))}if(function(e,t,s,n,r){var a;for(a in s)"children"===a||"key"===a||a in t||w(e,a,null,s[a],n);for(a in t)r&&"function"!=typeof t[a]||"children"===a||"key"===a||"value"===a||"checked"===a||s[a]===t[a]||w(e,a,t[a],s[a],n)}(e,f,d,a,l),m)s.__k=[];else if(b=s.props.children,E(e,Array.isArray(b)?b:[b],s,n,r,a&&"foreignObject"!==g,i,o,i?i[0]:n.__k&&D(n,0),l),null!=i)for(b=i.length;b--;)null!=i[b]&&h(i[b]);l||("value"in f&&void 0!==(b=f.value)&&(b!==e.value||"progress"===g&&!b)&&w(e,"value",b,d.value,!1),"checked"in f&&void 0!==(b=f.checked)&&b!==e.checked&&w(e,"checked",b,d.checked,!1))}return e}(r.__e,n,r,a,i,o,l,m);(g=s.diffed)&&g(n)}catch(e){n.__v=null,(m||null!=o)&&(n.__e=p,n.__h=!!m,o[o.indexOf(p)]=null),s.__e(e,n,r)}}function N(e,t){s.__c&&s.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){s.__e(e,t.__v)}}))}function B(e,t,n){try{"function"==typeof e?e(t):e.current=t}catch(e){s.__e(e,n)}}function O(e,t,n){var r,a;if(s.unmount&&s.unmount(e),(r=e.ref)&&(r.current&&r.current!==e.__e||B(r,null,t)),null!=(r=e.__c)){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(e){s.__e(e,t)}r.base=r.__P=null}if(r=e.__k)for(a=0;a<r.length;a++)r[a]&&O(r[a],t,"function"!=typeof e.type);n||null==e.__e||h(e.__e),e.__e=e.__d=void 0}function _(e,t,s){return this.constructor(e,s)}function T(e,n,r){var a,i,o;s.__&&s.__(e,n),i=(a="function"==typeof r)?null:r&&r.__k||n.__k,o=[],F(n,e=(!a&&r||n).__k=p(d,null,[e]),i||u,u,void 0!==n.ownerSVGElement,!a&&r?[r]:i?null:n.firstChild?t.call(n.childNodes):null,o,!a&&r?r:i?i.__e:n.firstChild,a),N(o,e)}t=o.slice,s={__e:function(e,t){for(var s,n,r;t=t.__;)if((s=t.__c)&&!s.__)try{if((n=s.constructor)&&null!=n.getDerivedStateFromError&&(s.setState(n.getDerivedStateFromError(e)),r=s.__d),null!=s.componentDidCatch&&(s.componentDidCatch(e),r=s.__d),r)return s.__E=s}catch(t){e=t}throw e}},n=0,f.prototype.setState=function(e,t){var s;s=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=c({},this.state),"function"==typeof e&&(e=e(c({},s),this.props)),e&&c(s,e),null!=e&&this.__v&&(t&&this.__h.push(t),b(this))},f.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),b(this))},f.prototype.render=d,r=[],a="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,C.__r=0;var x=function(e,t,s,n){var r;t[0]=0;for(var a=1;a<t.length;a++){var i=t[a++],u=t[a]?(t[0]|=i?1:2,s[t[a++]]):t[++a];3===i?n[0]=u:4===i?n[1]=Object.assign(n[1]||{},u):5===i?(n[1]=n[1]||{})[t[++a]]=u:6===i?n[1][t[++a]]+=u+"":i?(r=e.apply(u,x(e,u,s,["",null])),n.push(r),u[0]?t[0]|=2:(t[a-2]=0,t[a]=r)):n.push(u)}return n},$=new Map;var R={};function I(e){this.j={},this.jr=[],this.jd=null,this.t=e}e(R,"Options",(()=>te)),e(R,"options",(()=>ne)),e(R,"reset",(()=>De)),e(R,"registerPlugin",(()=>ge)),e(R,"registerCustomProtocol",(()=>be)),e(R,"init",(()=>Ce)),e(R,"tokenize",(()=>Ee)),e(R,"find",(()=>ve)),e(R,"test",(()=>ke)),I.prototype={accepts:function(){return!!this.t},tt:function(e,t){if(t&&t.j)return this.j[e]=t,t;var s=t,n=this.j[e];if(n)return s&&(n.t=s),n;n=L();var r=H(this,e);return r?(Object.assign(n.j,r.j),n.jr.append(r.jr),n.jr=r.jd,n.t=s||r.t):n.t=s,this.j[e]=n,n}};var L=function(){return new I},P=function(e){return new I(e)},M=function(e,t,s){e.j[t]||(e.j[t]=s)},j=function(e,t,s){e.jr.push([t,s])},H=function(e,t){var s=e.j[t];if(s)return s;for(var n=0;n<e.jr.length;n++){var r=e.jr[n][0],a=e.jr[n][1];if(r.test(t))return a}return e.jd},U=function(e,t,s){for(var n=0;n<t.length;n++)M(e,t[n],s)},K=function(e,t){for(var s=0;s<t.length;s++){var n=t[s][0],r=t[s][1];M(e,n,r)}},W=function(e,t,s,n){for(var r,a=0,i=t.length;a<i&&(r=e.j[t[a]]);)e=r,a++;if(a>=i)return[];for(;a<i-1;)r=n(),M(e,t[a],r),e=r,a++;M(e,t[i-1],s)},G=Object.freeze({__proto__:null,DOMAIN:"DOMAIN",LOCALHOST:"LOCALHOST",TLD:"TLD",NUM:"NUM",PROTOCOL:"PROTOCOL",MAILTO:"MAILTO",WS:"WS",NL:"NL",OPENBRACE:"OPENBRACE",OPENBRACKET:"OPENBRACKET",OPENANGLEBRACKET:"OPENANGLEBRACKET",OPENPAREN:"OPENPAREN",CLOSEBRACE:"CLOSEBRACE",CLOSEBRACKET:"CLOSEBRACKET",CLOSEANGLEBRACKET:"CLOSEANGLEBRACKET",CLOSEPAREN:"CLOSEPAREN",AMPERSAND:"AMPERSAND",APOSTROPHE:"APOSTROPHE",ASTERISK:"ASTERISK",AT:"AT",BACKSLASH:"BACKSLASH",BACKTICK:"BACKTICK",CARET:"CARET",COLON:"COLON",COMMA:"COMMA",DOLLAR:"DOLLAR",DOT:"DOT",EQUALS:"EQUALS",EXCLAMATION:"EXCLAMATION",HYPHEN:"HYPHEN",PERCENT:"PERCENT",PIPE:"PIPE",PLUS:"PLUS",POUND:"POUND",QUERY:"QUERY",QUOTE:"QUOTE",SEMI:"SEMI",SLASH:"SLASH",TILDE:"TILDE",UNDERSCORE:"UNDERSCORE",SYM:"SYM"}),z="aaa aarp abarth abb abbott abbvie abc able abogado abudhabi ac academy accenture accountant accountants aco actor ad adac ads adult ae aeg aero aetna af afamilycompany afl africa ag agakhan agency ai aig airbus airforce airtel akdn al alfaromeo alibaba alipay allfinanz allstate ally alsace alstom am amazon americanexpress americanfamily amex amfam amica amsterdam analytics android anquan anz ao aol apartments app apple aq aquarelle ar arab aramco archi army arpa art arte as asda asia associates at athleta attorney au auction audi audible audio auspost author auto autos avianca aw aws ax axa az azure ba baby baidu banamex bananarepublic band bank bar barcelona barclaycard barclays barefoot bargains baseball basketball bauhaus bayern bb bbc bbt bbva bcg bcn bd be beats beauty beer bentley berlin best bestbuy bet bf bg bh bharti bi bible bid bike bing bingo bio biz bj black blackfriday blockbuster blog bloomberg blue bm bms bmw bn bnpparibas bo boats boehringer bofa bom bond boo book booking bosch bostik boston bot boutique box br bradesco bridgestone broadway broker brother brussels bs bt budapest bugatti build builders business buy buzz bv bw by bz bzh ca cab cafe cal call calvinklein cam camera camp cancerresearch canon capetown capital capitalone car caravan cards care career careers cars casa case cash casino cat catering catholic cba cbn cbre cbs cc cd center ceo cern cf cfa cfd cg ch chanel channel charity chase chat cheap chintai christmas chrome church ci cipriani circle cisco citadel citi citic city cityeats ck cl claims cleaning click clinic clinique clothing cloud club clubmed cm cn co coach codes coffee college cologne com comcast commbank community company compare computer comsec condos construction consulting contact contractors cooking cookingchannel cool coop corsica country coupon coupons courses cpa cr credit creditcard creditunion cricket crown crs cruise cruises csc cu cuisinella cv cw cx cy cymru cyou cz dabur dad dance data date dating datsun day dclk dds de deal dealer deals degree delivery dell deloitte delta democrat dental dentist desi design dev dhl diamonds diet digital direct directory discount discover dish diy dj dk dm dnp do docs doctor dog domains dot download drive dtv dubai duck dunlop dupont durban dvag dvr dz earth eat ec eco edeka edu education ee eg email emerck energy engineer engineering enterprises epson equipment er ericsson erni es esq estate et etisalat eu eurovision eus events exchange expert exposed express extraspace fage fail fairwinds faith family fan fans farm farmers fashion fast fedex feedback ferrari ferrero fi fiat fidelity fido film final finance financial fire firestone firmdale fish fishing fit fitness fj fk flickr flights flir florist flowers fly fm fo foo food foodnetwork football ford forex forsale forum foundation fox fr free fresenius frl frogans frontdoor frontier ftr fujitsu fujixerox fun fund furniture futbol fyi ga gal gallery gallo gallup game games gap garden gay gb gbiz gd gdn ge gea gent genting george gf gg ggee gh gi gift gifts gives giving gl glade glass gle global globo gm gmail gmbh gmo gmx gn godaddy gold goldpoint golf goo goodyear goog google gop got gov gp gq gr grainger graphics gratis green gripe grocery group gs gt gu guardian gucci guge guide guitars guru gw gy hair hamburg hangout haus hbo hdfc hdfcbank health healthcare help helsinki here hermes hgtv hiphop hisamitsu hitachi hiv hk hkt hm hn hockey holdings holiday homedepot homegoods homes homesense honda horse hospital host hosting hot hoteles hotels hotmail house how hr hsbc ht hu hughes hyatt hyundai ibm icbc ice icu id ie ieee ifm ikano il im imamat imdb immo immobilien in inc industries infiniti info ing ink institute insurance insure int international intuit investments io ipiranga iq ir irish is ismaili ist istanbul it itau itv iveco jaguar java jcb je jeep jetzt jewelry jio jll jm jmp jnj jo jobs joburg jot joy jp jpmorgan jprs juegos juniper kaufen kddi ke kerryhotels kerrylogistics kerryproperties kfh kg kh ki kia kim kinder kindle kitchen kiwi km kn koeln komatsu kosher kp kpmg kpn kr krd kred kuokgroup kw ky kyoto kz la lacaixa lamborghini lamer lancaster lancia land landrover lanxess lasalle lat latino latrobe law lawyer lb lc lds lease leclerc lefrak legal lego lexus lgbt li lidl life lifeinsurance lifestyle lighting like lilly limited limo lincoln linde link lipsy live living lixil lk llc llp loan loans locker locus loft lol london lotte lotto love lpl lplfinancial lr ls lt ltd ltda lu lundbeck luxe luxury lv ly ma macys madrid maif maison makeup man management mango map market marketing markets marriott marshalls maserati mattel mba mc mckinsey md me med media meet melbourne meme memorial men menu merckmsd mg mh miami microsoft mil mini mint mit mitsubishi mk ml mlb mls mm mma mn mo mobi mobile moda moe moi mom monash money monster mormon mortgage moscow moto motorcycles mov movie mp mq mr ms msd mt mtn mtr mu museum mutual mv mw mx my mz na nab nagoya name nationwide natura navy nba nc ne nec net netbank netflix network neustar new news next nextdirect nexus nf nfl ng ngo nhk ni nico nike nikon ninja nissan nissay nl no nokia northwesternmutual norton now nowruz nowtv np nr nra nrw ntt nu nyc nz obi observer off office okinawa olayan olayangroup oldnavy ollo om omega one ong onl online onyourside ooo open oracle orange org organic origins osaka otsuka ott ovh pa page panasonic paris pars partners parts party passagens pay pccw pe pet pf pfizer pg ph pharmacy phd philips phone photo photography photos physio pics pictet pictures pid pin ping pink pioneer pizza pk pl place play playstation plumbing plus pm pn pnc pohl poker politie porn post pr pramerica praxi press prime pro prod productions prof progressive promo properties property protection pru prudential ps pt pub pw pwc py qa qpon quebec quest qvc racing radio raid re read realestate realtor realty recipes red redstone redumbrella rehab reise reisen reit reliance ren rent rentals repair report republican rest restaurant review reviews rexroth rich richardli ricoh ril rio rip rmit ro rocher rocks rodeo rogers room rs rsvp ru rugby ruhr run rw rwe ryukyu sa saarland safe safety sakura sale salon samsclub samsung sandvik sandvikcoromant sanofi sap sarl sas save saxo sb sbi sbs sc sca scb schaeffler schmidt scholarships school schule schwarz science scjohnson scot sd se search seat secure security seek select sener services ses seven sew sex sexy sfr sg sh shangrila sharp shaw shell shia shiksha shoes shop shopping shouji show showtime si silk sina singles site sj sk ski skin sky skype sl sling sm smart smile sn sncf so soccer social softbank software sohu solar solutions song sony soy spa space sport spot spreadbetting sr srl ss st stada staples star statebank statefarm stc stcgroup stockholm storage store stream studio study style su sucks supplies supply support surf surgery suzuki sv swatch swiftcover swiss sx sy sydney systems sz tab taipei talk taobao target tatamotors tatar tattoo tax taxi tc tci td tdk team tech technology tel temasek tennis teva tf tg th thd theater theatre tiaa tickets tienda tiffany tips tires tirol tj tjmaxx tjx tk tkmaxx tl tm tmall tn to today tokyo tools top toray toshiba total tours town toyota toys tr trade trading training travel travelchannel travelers travelersinsurance trust trv tt tube tui tunes tushu tv tvs tw tz ua ubank ubs ug uk unicom university uno uol ups us uy uz va vacations vana vanguard vc ve vegas ventures verisign versicherung vet vg vi viajes video vig viking villas vin vip virgin visa vision viva vivo vlaanderen vn vodka volkswagen volvo vote voting voto voyage vu vuelos wales walmart walter wang wanggou watch watches weather weatherchannel webcam weber website wed wedding weibo weir wf whoswho wien wiki williamhill win windows wine winners wme wolterskluwer woodside work works world wow ws wtc wtf xbox xerox xfinity xihuan xin xxx xyz yachts yahoo yamaxun yandex ye yodobashi yoga yokohama you youtube yt yun za zappos zara zero zip zm zone zuerich zw vermögensberater-ctb vermögensberatung-pwb ελ ευ бг бел дети ею католик ком қаз мкд мон москва онлайн орг рус рф сайт срб укр გე հայ ישראל קום ابوظبي اتصالات ارامكو الاردن البحرين الجزائر السعودية العليان المغرب امارات ایران بارت بازار بھارت بيتك پاکستان ڀارت تونس سودان سورية شبكة عراق عرب عمان فلسطين قطر كاثوليك كوم مصر مليسيا موريتانيا موقع همراه कॉम नेट भारत भारतम् भारोत संगठन বাংলা ভারত ভাৰত ਭਾਰਤ ભારત ଭାରତ இந்தியா இலங்கை சிங்கப்பூர் భారత్ ಭಾರತ ഭാരതം ලංකා คอม ไทย ລາວ 닷넷 닷컴 삼성 한국 アマゾン グーグル クラウド コム ストア セール ファッション ポイント みんな 世界 中信 中国 中國 中文网 亚马逊 企业 佛山 信息 健康 八卦 公司 公益 台湾 台灣 商城 商店 商标 嘉里 嘉里大酒店 在线 大众汽车 大拿 天主教 娱乐 家電 广东 微博 慈善 我爱你 手机 招聘 政务 政府 新加坡 新闻 时尚 書籍 机构 淡马锡 游戏 澳門 点看 移动 组织机构 网址 网店 网站 网络 联通 诺基亚 谷歌 购物 通販 集团 電訊盈科 飞利浦 食品 餐厅 香格里拉 香港".split(" "),q=/(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDEC0-\uDEEB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/,Q=/(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5-\uDED7\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFC\uDFE0-\uDFEB]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDD78\uDD7A-\uDDCB\uDDCD-\uDDFF\uDE70-\uDE74\uDE78-\uDE7A\uDE80-\uDE86\uDE90-\uDEA8\uDEB0-\uDEB6\uDEC0-\uDEC2\uDED0-\uDED6])/,Y=/\uFE0F/,J=/\d/,V=/\s/;function X(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=L(),s=P("NUM"),n=P("DOMAIN"),r=L(),a=P("WS"),i=[[J,n],[q,n],[Q,n],[Y,n]],u=function(){var e=P("DOMAIN");return e.j={"-":r},e.jr=[].concat(i),e},o=function(e){var t=u();return t.t=e,t};K(t,[["'",P("APOSTROPHE")],["{",P("OPENBRACE")],["[",P("OPENBRACKET")],["<",P("OPENANGLEBRACKET")],["(",P("OPENPAREN")],["}",P("CLOSEBRACE")],["]",P("CLOSEBRACKET")],[">",P("CLOSEANGLEBRACKET")],[")",P("CLOSEPAREN")],["&",P("AMPERSAND")],["*",P("ASTERISK")],["@",P("AT")],["`",P("BACKTICK")],["^",P("CARET")],[":",P("COLON")],[",",P("COMMA")],["$",P("DOLLAR")],[".",P("DOT")],["=",P("EQUALS")],["!",P("EXCLAMATION")],["-",P("HYPHEN")],["%",P("PERCENT")],["|",P("PIPE")],["+",P("PLUS")],["#",P("POUND")],["?",P("QUERY")],['"',P("QUOTE")],["/",P("SLASH")],[";",P("SEMI")],["~",P("TILDE")],["_",P("UNDERSCORE")],["\\",P("BACKSLASH")]]),M(t,"\n",P("NL")),j(t,V,a),M(a,"\n",L()),j(a,V,a);for(var l=0;l<z.length;l++)W(t,z[l],o("TLD"),u);var c=u(),h=u(),p=u(),m=u();W(t,"file",c,u),W(t,"ftp",h,u),W(t,"http",p,u),W(t,"mailto",m,u);var d=u(),f=P("PROTOCOL"),D=P("MAILTO");M(h,"s",d),M(h,":",f),M(p,"s",d),M(p,":",f),M(c,":",f),M(d,":",f),M(m,":",D);for(var g=u(),b=0;b<e.length;b++)W(t,e[b],g,u);return M(g,":",f),W(t,"localhost",o("LOCALHOST"),u),j(t,J,s),j(t,q,n),j(t,Q,n),j(t,Y,n),j(s,J,s),j(s,q,n),j(s,Q,n),j(s,Y,n),M(s,"-",r),M(n,"-",r),M(r,"-",r),j(n,J,n),j(n,q,n),j(n,Q,n),j(n,Y,n),j(r,J,n),j(r,q,n),j(r,Q,n),j(r,Y,n),t.jd=P("SYM"),t}function Z(e){return Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z(e)}var ee={defaultProtocol:"http",events:null,format:se,formatHref:se,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:0,className:null,attributes:null,ignoreTags:[]};function te(e){e=e||{},this.defaultProtocol="defaultProtocol"in e?e.defaultProtocol:ee.defaultProtocol,this.events="events"in e?e.events:ee.events,this.format="format"in e?e.format:ee.format,this.formatHref="formatHref"in e?e.formatHref:ee.formatHref,this.nl2br="nl2br"in e?e.nl2br:ee.nl2br,this.tagName="tagName"in e?e.tagName:ee.tagName,this.target="target"in e?e.target:ee.target,this.rel="rel"in e?e.rel:ee.rel,this.validate="validate"in e?e.validate:ee.validate,this.truncate="truncate"in e?e.truncate:ee.truncate,this.className="className"in e?e.className:ee.className,this.attributes=e.attributes||ee.attributes,this.ignoreTags=[];for(var t=("ignoreTags"in e?e.ignoreTags:ee.ignoreTags),s=0;s<t.length;s++)this.ignoreTags.push(t[s].toUpperCase())}function se(e){return e}te.prototype={resolve:function(e){var t=e.toHref(this.defaultProtocol);return{formatted:this.get("format",e.toString(),e),formattedHref:this.get("formatHref",t,e),tagName:this.get("tagName",t,e),className:this.get("className",t,e),target:this.get("target",t,e),rel:this.get("rel",t,e),events:this.getObject("events",t,e),attributes:this.getObject("attributes",t,e),truncate:this.get("truncate",t,e)}},check:function(e){return this.get("validate",e.toString(),e)},get:function(e,t,s){var n,r=this[e];if(!r)return r;switch(Z(r)){case"function":return r(t,s.t);case"object":return"function"==typeof(n=s.t in r?r[s.t]:ee[e])?n(t,s.t):n}return r},getObject:function(e,t,s){var n=this[e];return"function"==typeof n?n(t,s.t):n}};var ne=Object.freeze({__proto__:null,defaults:ee,Options:te});function re(){}function ae(e,t){function s(t,s){this.t=e,this.v=t,this.tk=s}return function(e,t){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Object.create(e.prototype);for(var r in s)n[r]=s[r];n.constructor=t,t.prototype=n}(re,s,t),s}re.prototype={t:"token",isLink:!1,toString:function(){return this.v},toHref:function(){return this.toString()},startIndex:function(){return this.tk[0].s},endIndex:function(){return this.tk[this.tk.length-1].e},toObject:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee.defaultProtocol;return{type:this.t,value:this.v,isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}}};var ie=ae("email",{isLink:!0}),ue=ae("email",{isLink:!0,toHref:function(){return"mailto:"+this.toString()}}),oe=ae("text"),le=ae("nl"),ce=ae("url",{isLink:!0,toHref:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee.defaultProtocol,t=this.tk,s=!1,n=!1,r=[],a=0;"PROTOCOL"===t[a].t;)s=!0,r.push(t[a].v),a++;for(;"SLASH"===t[a].t;)n=!0,r.push(t[a].v),a++;for(;a<t.length;a++)r.push(t[a].v);return r=r.join(""),s||n||(r="".concat(e,"://").concat(r)),r},hasProtocol:function(){return"PROTOCOL"===this.tk[0].t}}),he=Object.freeze({__proto__:null,MultiToken:re,Base:re,createTokenClass:ae,MailtoEmail:ie,Email:ue,Text:oe,Nl:le,Url:ce});function pe(){var e=L(),t=L(),s=L(),n=L(),r=L(),a=L(),i=L(),u=P(ce),o=L(),l=P(ce),c=P(ce),h=L(),p=L(),m=L(),d=L(),f=L(),D=P(ce),g=P(ce),b=P(ce),C=P(ce),E=L(),v=L(),k=L(),A=L(),w=L(),y=L(),S=P(ue),F=L(),N=P(ue),B=P(ie),O=L(),_=L(),T=L(),x=L(),$=P(le);M(e,"NL",$),M(e,"PROTOCOL",t),M(e,"MAILTO",s),M(t,"SLASH",n),M(n,"SLASH",r),M(e,"TLD",a),M(e,"DOMAIN",a),M(e,"LOCALHOST",u),M(e,"NUM",a),M(r,"TLD",c),M(r,"DOMAIN",c),M(r,"NUM",c),M(r,"LOCALHOST",c),M(a,"DOT",i),M(w,"DOT",y),M(i,"TLD",u),M(i,"DOMAIN",a),M(i,"NUM",a),M(i,"LOCALHOST",a),M(y,"TLD",S),M(y,"DOMAIN",w),M(y,"NUM",w),M(y,"LOCALHOST",w),M(u,"DOT",i),M(S,"DOT",y),M(u,"COLON",o),M(u,"SLASH",c),M(o,"NUM",l),M(l,"SLASH",c),M(S,"COLON",F),M(F,"NUM",N);var R=["AMPERSAND","ASTERISK","AT","BACKSLASH","BACKTICK","CARET","DOLLAR","DOMAIN","EQUALS","HYPHEN","LOCALHOST","NUM","PERCENT","PIPE","PLUS","POUND","PROTOCOL","SLASH","SYM","TILDE","TLD","UNDERSCORE"],I=["APOSTROPHE","CLOSEANGLEBRACKET","CLOSEBRACE","CLOSEBRACKET","CLOSEPAREN","COLON","COMMA","DOT","EXCLAMATION","OPENANGLEBRACKET","OPENBRACE","OPENBRACKET","OPENPAREN","QUERY","QUOTE","SEMI"];M(c,"OPENBRACE",p),M(c,"OPENBRACKET",m),M(c,"OPENANGLEBRACKET",d),M(c,"OPENPAREN",f),M(h,"OPENBRACE",p),M(h,"OPENBRACKET",m),M(h,"OPENANGLEBRACKET",d),M(h,"OPENPAREN",f),M(p,"CLOSEBRACE",c),M(m,"CLOSEBRACKET",c),M(d,"CLOSEANGLEBRACKET",c),M(f,"CLOSEPAREN",c),M(D,"CLOSEBRACE",c),M(g,"CLOSEBRACKET",c),M(b,"CLOSEANGLEBRACKET",c),M(C,"CLOSEPAREN",c),M(E,"CLOSEBRACE",c),M(v,"CLOSEBRACKET",c),M(k,"CLOSEANGLEBRACKET",c),M(A,"CLOSEPAREN",c),U(p,R,D),U(m,R,g),U(d,R,b),U(f,R,C),U(p,I,E),U(m,I,v),U(d,I,k),U(f,I,A),U(D,R,D),U(g,R,g),U(b,R,b),U(C,R,C),U(D,I,D),U(g,I,g),U(b,I,b),U(C,I,C),U(E,R,D),U(v,R,g),U(k,R,b),U(A,R,C),U(E,I,E),U(v,I,v),U(k,I,k),U(A,I,A),U(c,R,c),U(h,R,c),U(c,I,h),U(h,I,h),M(s,"TLD",B),M(s,"DOMAIN",B),M(s,"NUM",B),M(s,"LOCALHOST",B),U(B,R,B),U(B,I,O),U(O,R,B),U(O,I,O);var j=["AMPERSAND","APOSTROPHE","ASTERISK","BACKSLASH","BACKTICK","CARET","CLOSEBRACE","DOLLAR","DOMAIN","EQUALS","HYPHEN","NUM","OPENBRACE","PERCENT","PIPE","PLUS","POUND","QUERY","SLASH","SYM","TILDE","TLD","UNDERSCORE"];return U(a,j,_),M(a,"AT",T),U(u,j,_),M(u,"AT",T),U(i,j,_),U(_,j,_),M(_,"AT",T),M(_,"DOT",x),U(x,j,_),M(T,"TLD",w),M(T,"DOMAIN",w),M(T,"NUM",w),M(T,"LOCALHOST",S),e}function me(e,t,s){var n=s[0].s,r=s[s.length-1].e;return new e(t.substr(n,r-n),s)}var de="undefined"!=typeof console&&console&&console.warn||function(){},fe={scanner:null,parser:null,pluginQueue:[],customProtocols:[],initialized:!1};function De(){fe.scanner=null,fe.parser=null,fe.pluginQueue=[],fe.customProtocols=[],fe.initialized=!1}function ge(e,t){for(var s=0;s<fe.pluginQueue.length;s++)if(e===fe.pluginQueue[s][0])return de('linkifyjs: plugin "'.concat(e,'" already registered - will be overwritten')),void(fe.pluginQueue[s]=[e,t]);fe.pluginQueue.push([e,t]),fe.initialized&&de('linkifyjs: already initialized - will not register plugin "'.concat(e,'" until you manually call linkify.init(). To avoid this warning, please register all plugins before invoking linkify the first time.'))}function be(e){if(fe.initialized&&de('linkifyjs: already initialized - will not register custom protocol "'.concat(e,'" until you manually call linkify.init(). To avoid this warning, please register all custom protocols before invoking linkify the first time.')),!/^[a-z-]+$/.test(e))throw Error("linkifyjs: protocols containing characters other than a-z or - (hyphen) are not supported");fe.customProtocols.push(e)}function Ce(){fe.scanner={start:X(fe.customProtocols),tokens:G},fe.parser={start:pe(),tokens:he};for(var e={createTokenClass:ae},t=0;t<fe.pluginQueue.length;t++)fe.pluginQueue[t][1]({scanner:fe.scanner,parser:fe.parser,utils:e});fe.initialized=!0}function Ee(e){return fe.initialized||Ce(),function(e,t,s){for(var n=s.length,r=0,a=[],i=[];r<n;){for(var u=e,o=null,l=null,c=0,h=null,p=-1;r<n&&!(o=H(u,s[r].t));)i.push(s[r++]);for(;r<n&&(l=o||H(u,s[r].t));)o=null,(u=l).accepts()?(p=0,h=u):p>=0&&p++,r++,c++;if(p<0)for(var m=r-c;m<r;m++)i.push(s[m]);else{i.length>0&&(a.push(me(oe,t,i)),i=[]),r-=p,c-=p;var d=h.t,f=s.slice(r-c,r);a.push(me(d,t,f))}}return i.length>0&&a.push(me(oe,t,i)),a}(fe.parser.start,e,function(e,t){for(var s=function(e){for(var t=[],s=e.length,n=0;n<s;){var r=e.charCodeAt(n),a=void 0,i=r<55296||r>56319||n+1===s||(a=e.charCodeAt(n+1))<56320||a>57343?e[n]:e.slice(n,n+2);t.push(i),n+=i.length}return t}(t.replace(/[A-Z]/g,(function(e){return e.toLowerCase()}))),n=s.length,r=[],a=0,i=0;i<n;){for(var u=e,o=null,l=0,c=null,h=-1,p=-1;i<n&&(o=H(u,s[i]));)(u=o).accepts()?(h=0,p=0,c=u):h>=0&&(h+=s[i].length,p++),l+=s[i].length,a+=s[i].length,i++;a-=h,i-=p,l-=h,r.push({t:c.t,v:t.substr(a-l,l),s:a-l,e:a})}return r}(fe.scanner.start,e))}function ve(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=Ee(e),n=[],r=0;r<s.length;r++){var a=s[r];!a.isLink||t&&a.t!==t||n.push(a.toObject())}return n}function ke(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=Ee(e);return 1===s.length&&s[0].isLink&&(!t||s[0].t===t)}const Ae=function(e){var t=$.get(this);return t||(t=new Map,$.set(this,t)),(t=x(this,t.get(e)||(t.set(e,t=function(e){for(var t,s,n=1,r="",a="",i=[0],u=function(e){1===n&&(e||(r=r.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?i.push(0,e,r):3===n&&(e||r)?(i.push(3,e,r),n=2):2===n&&"..."===r&&e?i.push(4,e,0):2===n&&r&&!e?i.push(5,0,!0,r):n>=5&&((r||!e&&5===n)&&(i.push(n,0,r,s),n=6),e&&(i.push(n,e,0,s),n=6)),r=""},o=0;o<e.length;o++){o&&(1===n&&u(),u(o));for(var l=0;l<e[o].length;l++)t=e[o][l],1===n?"<"===t?(u(),i=[i],n=3):r+=t:4===n?"--"===r&&">"===t?(n=1,r=""):r=t+r[0]:a?t===a?a="":r+=t:'"'===t||"'"===t?a=t:">"===t?(u(),n=1):n&&("="===t?(n=5,s=r,r=""):"/"===t&&(n<5||">"===e[o][l+1])?(u(),3===n&&(i=i[0]),n=i,(i=i[0]).push(2,0,n),n=0):" "===t||"\t"===t||"\n"===t||"\r"===t?(u(),n=2):r+=t),3===n&&"!--"===r&&(n=4,i=i[0])}return u(),i}(e)),t),arguments,[])).length>1?t:t[0]}.bind(p),we={";":"\\:"," ":"\\s","\\":"\\\\","\r":"\\r","\n":"\\n"},ye=Object.fromEntries(Object.entries(we).map((([e,t])=>[t,e])));function Se(e){let t={};return e.split(";").forEach((e=>{if(!e)return;let s=e.split("=",2),n=s[0],r=null;2==s.length&&(r=function(e){return e.replace(/\\[:s\\rn]/g,(e=>ye[e]))}(s[1]),r.endsWith("\\")&&(r=r.slice(0,r.length-1))),t[n]=r})),t}function Fe(e){let t=[];for(let n in e){if(void 0===e[n]||null===e[n]){t.push(n);continue}let r=(s=e[n],String(s).replace(/[; \\\r\n]/g,(e=>we[e])));t.push(n+"="+r)}var s;return t.join(";")}function Ne(e){let t=null,s=e.indexOf("@");s>0&&(t=e.slice(s+1),e=e.slice(0,s));let n=null;return s=e.indexOf("!"),s>0&&(n=e.slice(s+1),e=e.slice(0,s)),{name:e,user:n,host:t}}function Be(e){e.endsWith("\r\n")&&(e=e.slice(0,e.length-2));let t={tags:{},prefix:null,command:null,params:[]};if(e.startsWith("@")){let s=e.indexOf(" ");if(s<0)throw new Error("expected a space after tags");t.tags=Se(e.slice(1,s)),e=e.slice(s+1)}if(e.startsWith(":")){let s=e.indexOf(" ");if(s<0)throw new Error("expected a space after prefix");t.prefix=Ne(e.slice(1,s)),e=e.slice(s+1)}let s=e.indexOf(" ");if(s<0)return t.command=e,t;for(t.command=e.slice(0,s),e=e.slice(s+1);;){if(e.startsWith(":")){t.params.push(e.slice(1));break}if(s=e.indexOf(" "),s<0){t.params.push(e);break}t.params.push(e.slice(0,s)),e=e.slice(s+1)}return t}function Oe(e,t="~&@%+"){let s;for(s=0;s<e.length&&!(t.indexOf(e[s])<0);s++);return{prefix:e.slice(0,s),name:e.slice(s)}}const _e=(()=>{try{return new RegExp(/^\p{L}$/,"u")}catch(e){return new RegExp(/^[a-zA-Z0-9]$/,"u")}})();function Te(e){switch(e){case"-":case"_":case"|":return!1;case" ":return!0;default:return!_e.test(e)}}function xe(e){if(e>="400"&&e<="568")return!0;switch(e){case"902":case"904":case"905":case"906":case"907":case"734":case"FAIL":return!0;default:return!1}}function $e(e){return`${e.getUTCFullYear().toString().padStart(4,"0")}-${(e.getUTCMonth()+1).toString().padStart(2,"0")}-${e.getUTCDate().toString().padStart(2,"0")}T${e.getUTCHours().toString().padStart(2,"0")}:${e.getUTCMinutes().toString().padStart(2,"0")}:${e.getUTCSeconds().toString().padStart(2,"0")}.${e.getUTCMilliseconds().toString().padStart(3,"0")}Z`}function Re(e){if("PRIVMSG"!=e.command&&"NOTICE"!=e.command)return null;let t,s=e.params[1];if(!s.startsWith(""))return null;s=s.slice(1),s.endsWith("")&&(s=s.slice(0,-1));let n=s.indexOf(" ");return t=n>=0?{command:s.slice(0,n),param:s.slice(n+1)}:{command:s,param:""},t.command=t.command.toUpperCase(),t}function Ie(e,t){let s=[];return e.forEach((e=>{if(e.startsWith("-")){let s=e.slice(1);return void t.delete(s.toUpperCase())}let n=e.indexOf("="),r=e,a="";n>=0&&(r=e.slice(0,n),a=e.slice(n+1).replace(/\\x[0-9A-Z]{2}/gi,(e=>{let t=e.slice(2);return String.fromCharCode(parseInt(t,16))}))),r=r.toUpperCase(),t.set(r,a),s.push(r)})),s}const Le={ASCII(e){let t="";for(let s=0;s<e.length;s++){let n=e[s];"A"<=n&&n<="Z"&&(n=n.toLowerCase()),t+=n}return t},RFC1459(e){let t="";for(let s=0;s<e.length;s++){let n=e[s];"A"<=n&&n<="Z"?n=n.toLowerCase():"{"==n?n="[":"}"==n?n="]":"\\"==n?n="|":"~"==n&&(n="^"),t+=n}return t},RFC1459Strict(e){let t="";for(let s=0;s<e.length;s++){let n=e[s];"A"<=n&&n<="Z"?n=n.toLowerCase():"{"==n?n="[":"}"==n?n="]":"\\"==n&&(n="|"),t+=n}return t},byName(e){switch(e){case"ascii":return Le.ASCII;case"rfc1459":return Le.RFC1459;case"rfc1459-strict":return Le.RFC1459Strict}return null}};function Pe(e,t){return function(e){let t={next:e};return t[Symbol.iterator]=()=>t,t}((()=>{let{value:s,done:n}=e.next();return n?{done:!0}:{value:t(s),done:!1}}))}class Me{caseMap=null;map=null;constructor(e,t){if(e instanceof Me&&(e.caseMap===t||!t))this.caseMap=e.caseMap,this.map=new Map(e.map);else{if(!t)throw new Error("Missing case-mapping when creating CaseMapMap");if(this.caseMap=t,this.map=new Map,e)for(let[t,s]of e)this.set(t,s)}}get size(){return this.map.size}has(e){return this.map.has(this.caseMap(e))}get(e){let t=this.map.get(this.caseMap(e));if(t)return t.value}set(e,t){this.map.set(this.caseMap(e),{key:e,value:t})}delete(e){this.map.delete(this.caseMap(e))}entries(){return Pe(this.map.values(),(e=>[e.key,e.value]))}keys(){return Pe(this.map.values(),(e=>e.key))}values(){return Pe(this.map.values(),(e=>e.value))}[Symbol.iterator](){return this.entries()}}function je(e){if("("!==e[0])throw new Error("malformed ISUPPORT PREFIX value: expected opening parenthesis");let t=e.indexOf(")");if(t<0)throw new Error("malformed ISUPPORT PREFIX value: expected closing parenthesis");let s=e.length-t-1,n=[];for(let r=0;r<s;r++){let s=e[r+1],a=e[t+r+1];n.push({mode:s,prefix:a})}return n}function He(e,t){let s=e.batch;for(;s;){if(s.type===t)return s;s=s.parent}return null}function Ue(e,t){return!(!e||e===t)&&("realname"!==e.toLowerCase()&&"unknown"!==e.toLowerCase()&&"fullname"!==e.toLowerCase())}function Ke(e){if(!e.startsWith("irc://")&&!e.startsWith("ircs://"))return null;let t,s=(e=e.slice(e.indexOf(":")+3)).indexOf("/");s<0?(t=e,e=""):(t=e.slice(0,s),e=e.slice(s+1));let n,r=t;if(s=t.indexOf("@"),s>=0&&(r=t.slice(s+1)),s=e.indexOf("?"),s>=0&&(e=e.slice(0,s)),s=e.indexOf(","),s>=0){let t=e.slice(s+1).split(",");e=e.slice(0,s),t.indexOf("isuser")>=0?n="user":t.indexOf("ischannel")>=0&&(n="channel")}let a=decodeURIComponent(e);return n||(n=a.startsWith("#")?"channel":"user"),{host:r,enttype:n,entity:a}}const We=["account-notify","away-notify","batch","chghost","echo-message","extended-join","invite-notify","labeled-response","message-tags","multi-prefix","server-time","setname","draft/chathistory","draft/event-playback","draft/extended-monitor","soju.im/bouncer-networks"],Ge={channel:"c",username:"u",hostname:"h",server:"s",nick:"n",flags:"f",account:"a",realname:"r"};let ze=0,qe=0;class Qe extends EventTarget{static Status={DISCONNECTED:"disconnected",CONNECTING:"connecting",REGISTERING:"registering",REGISTERED:"registered"};status=Qe.Status.DISCONNECTED;serverPrefix={name:"*"};nick=null;supportsCap=!1;availableCaps={};enabledCaps={};isupport=new Map;ws=null;params={url:null,username:null,realname:null,nick:null,pass:null,saslPlain:null,saslExternal:!1,bouncerNetwork:null};batches=new Map;autoReconnect=!0;reconnectTimeoutID=null;pingIntervalID=null;pendingCmds={WHO:Promise.resolve(null),CHATHISTORY:Promise.resolve(null)};cm=Le.RFC1459;monitored=new Me(null,Le.RFC1459);pendingLists=new Me(null,Le.RFC1459);whoxQueries=new Map;constructor(e){super(),this.params={...this.params,...e},this.reconnect()}reconnect(){let e=this.autoReconnect;this.disconnect(),this.autoReconnect=e,console.log("Connecting to "+this.params.url),this.setStatus(Qe.Status.CONNECTING);try{this.ws=new WebSocket(this.params.url)}catch(e){return console.error("Failed to create connection:",e),void setTimeout((()=>{this.dispatchEvent(new CustomEvent("error",{detail:"Failed to create connection: "+e})),this.setStatus(Qe.Status.DISCONNECTED)}),0)}this.ws.addEventListener("open",this.handleOpen.bind(this)),this.ws.addEventListener("message",this.handleMessage.bind(this)),this.ws.addEventListener("close",(e=>{if(console.log("Connection closed (code: "+e.code+")"),1e3!==e.code&&1001!==e.code&&this.dispatchEvent(new CustomEvent("error",{detail:"Connection error"})),this.ws=null,this.setStatus(Qe.Status.DISCONNECTED),this.nick=null,this.serverPrefix=null,this.availableCaps={},this.enabledCaps={},this.batches=new Map,Object.keys(this.pendingCmds).forEach((e=>{this.pendingCmds[e]=Promise.resolve(null)})),this.isupport=new Map,this.monitored=new Me(null,Le.RFC1459),this.autoReconnect)if(navigator.onLine)console.info("Reconnecting to server in 10 seconds"),clearTimeout(this.reconnectTimeoutID),this.reconnectTimeoutID=setTimeout((()=>{this.reconnect()}),1e4);else{console.info("Waiting for network to go back online");const e=()=>{window.removeEventListener("online",e),this.reconnect()};window.addEventListener("online",e)}}))}disconnect(){this.autoReconnect=!1,clearTimeout(this.reconnectTimeoutID),this.reconnectTimeoutID=null,this.setPingInterval(0),this.ws&&this.ws.close(1e3)}setStatus(e){this.status!==e&&(this.status=e,this.dispatchEvent(new CustomEvent("status")))}handleOpen(){console.log("Connection opened"),this.setStatus(Qe.Status.REGISTERING),this.nick=this.params.nick,this.send({command:"CAP",params:["LS","302"]}),this.params.pass&&this.send({command:"PASS",params:[this.params.pass]}),this.send({command:"NICK",params:[this.nick]}),this.send({command:"USER",params:[this.params.username,"0","*",this.params.realname]})}pushPendingList(e,t){let s=this.pendingLists.get(e);s||(s=[],this.pendingLists.set(e,s)),s.push(t)}endPendingList(e,t){t.list=this.pendingLists.get(e)||[],this.pendingLists.delete(e)}handleMessage(e){if("string"!=typeof e.data)return console.error("Received unsupported data type:",e.data),void this.ws.close(1003);let t=Be(e.data);console.debug("Received:",t),t.prefix||(t.prefix=this.serverPrefix);let s=null;t.tags.batch&&(s=this.batches.get(t.tags.batch),s&&(t.batch=s));let n=null;switch(t.command){case"001":if(this.params.saslPlain&&!this.supportsCap)return this.dispatchEvent(new CustomEvent("error",{detail:"Server doesn't support SASL PLAIN"})),void this.disconnect();t.prefix&&(this.serverPrefix=t.prefix),console.log("Registration complete"),this.setStatus(Qe.Status.REGISTERED);break;case"005":let e=Ie(t.params.slice(1,-1),this.isupport);if(e.indexOf("CASEMAPPING")>=0&&this.setCaseMapping(this.isupport.get("CASEMAPPING")),e.indexOf("MONITOR")>=0&&this.isupport.has("MONITOR")&&this.monitored.size>0){let e=Array.from(this.monitored.keys()).slice(0,this.maxMonitorTargets());this.send({command:"MONITOR",params:["+",e.join(",")]})}break;case"376":case"422":this.isupport.has("CASEMAPPING")||this.setCaseMapping("rfc1459");break;case"CAP":this.handleCap(t);break;case"AUTHENTICATE":this.handleAuthenticate(t);break;case"900":console.log("Logged in");break;case"901":console.log("Logged out");break;case"903":console.log("SASL authentication success"),this.status!=Qe.Status.REGISTERED&&(this.enabledCaps["soju.im/bouncer-networks"]&&this.params.bouncerNetwork&&this.send({command:"BOUNCER",params:["BIND",this.params.bouncerNetwork]}),this.send({command:"CAP",params:["END"]}));break;case"353":this.pushPendingList("NAMES "+t.params[2],t);break;case"366":this.endPendingList("NAMES "+t.params[1],t);break;case"311":case"312":case"313":case"317":case"319":this.pushPendingList("WHOIS "+t.params[1],t);break;case"318":this.endPendingList("WHOIS "+t.params[1],t);break;case"352":case"354":this.pushPendingList("WHO",t);break;case"315":this.endPendingList("WHO",t);break;case"902":case"904":case"905":case"906":case"907":this.dispatchEvent(new CustomEvent("error",{detail:"SASL error ("+t.command+"): "+t.params[1]})),this.disconnect();break;case"PING":this.send({command:"PONG",params:[t.params[0]]});break;case"NICK":let r=t.params[0];this.isMyNick(t.prefix.name)&&(this.nick=r);break;case"BATCH":let a=t.params[0].startsWith("+"),i=t.params[0].slice(1);if(a){let e={name:i,type:t.params[1],params:t.params.slice(2),tags:t.tags,parent:s};this.batches.set(i,e)}else n=i;break;case"ERROR":this.dispatchEvent(new CustomEvent("error",{detail:"Fatal IRC error: "+t.params[0]})),this.disconnect();break;case"464":case"432":case"433":case"436":case"437":case"463":case"465":this.dispatchEvent(new CustomEvent("error",{detail:"Error ("+t.command+"): "+t.params[t.params.length-1]})),this.status!=Qe.Status.REGISTERED&&this.disconnect();break;case"FAIL":"BOUNCER"===t.params[0]&&"BIND"===t.params[2]&&(this.dispatchEvent(new CustomEvent("error",{detail:"Failed to bind to bouncer network: "+t.params[3]})),this.disconnect())}this.dispatchEvent(new CustomEvent("message",{detail:{message:t,batch:s}})),n&&this.batches.delete(n)}who(e,t){let s=[e],n="",r="";if(t&&this.isupport.has("WHOX")){let e="";n="t",t.fields&&t.fields.forEach((e=>{if(!Ge[e])throw new Error(`Unknown WHOX field ${e}`);n+=Ge[e]})),r=String(qe%1e3),qe++,s.push(`${e}%${n},${r}`),this.whoxQueries.set(r,n)}let a={command:"WHO",params:s},i=[],u=this.pendingCmds.WHO.then((()=>this.roundtrip(a,(t=>{switch(t.command){case"352":i.push(this.parseWhoReply(t));break;case"354":if(t.params.length!==n.length||t.params[1]!==r)break;i.push(this.parseWhoReply(t));break;case"315":if(t.params[1]===e)return i}})).finally((()=>{this.whoxQueries.delete(r)}))));return this.pendingCmds.WHO=u.catch((()=>{})),u}parseWhoReply(e){switch(e.command){case"352":let t=e.params[e.params.length-1];return{username:e.params[2],hostname:e.params[3],server:e.params[4],nick:e.params[5],flags:e.params[6],realname:t.slice(t.indexOf(" ")+1)};case"354":let s=e.params[1],n=this.whoxQueries.get(s);if(!n)throw new Error("Unknown WHOX token: "+s);let r={},a=0;return Object.keys(Ge).forEach((t=>{n.indexOf(Ge[t])<0||(r[t]=e.params[2+a],a++)})),"0"===r.account&&(r.account=null),r;default:throw new Error("Not a WHO reply: "+e.command)}}whois(e){let t=this.cm(e),s={command:"WHOIS",params:[e]};return this.roundtrip(s,(e=>{let s;switch(e.command){case"318":if(s=e.params[1],this.cm(s)===t){let t={};return e.list.forEach((e=>{t[e.command]=e})),t}break;case"401":if(s=e.params[1],this.cm(s)===t)throw e}}))}addAvailableCaps(e){e.split(" ").forEach((e=>{let t=e.indexOf("="),s=e,n="";t>=0&&(s=e.slice(0,t),n=e.slice(t+1)),this.availableCaps[s.toLowerCase()]=n}))}supportsSASL(e){let t=this.availableCaps.sasl;return void 0!==t&&t.split(",").includes(e)}requestCaps(e){let t=e||[];We.forEach((e=>{void 0===this.availableCaps[e]||this.enabledCaps[e]||t.push(e)})),t.length>0&&this.send({command:"CAP",params:["REQ",t.join(" ")]})}handleCap(e){let t=e.params[1],s=e.params.slice(2);switch(t){case"LS":if(this.supportsCap=!0,this.addAvailableCaps(s[s.length-1]),"*"!=s[0]){console.log("Available server caps:",this.availableCaps);let e=[],t=!0;(this.params.saslPlain&&this.supportsSASL("PLAIN")||this.params.saslExternal&&this.supportsSASL("EXTERNAL"))&&(e.push("sasl"),t=!1),this.params.bouncerNetwork||void 0===this.availableCaps["soju.im/bouncer-networks-notify"]||e.push("soju.im/bouncer-networks-notify"),this.requestCaps(e),this.status!=Qe.Status.REGISTERED&&t&&this.send({command:"CAP",params:["END"]})}break;case"NEW":this.addAvailableCaps(s[0]),console.log("Server added available caps:",s[0]),this.requestCaps();break;case"DEL":s[0].split(" ").forEach((e=>{e=e.toLowerCase(),delete this.availableCaps[e],delete this.enabledCaps[e]})),console.log("Server removed available caps:",s[0]);break;case"ACK":console.log("Server ack'ed caps:",s[0]),s[0].split(" ").forEach((e=>{e=e.toLowerCase(),this.enabledCaps[e]=!0,"sasl"==e&&this.params.saslPlain?(console.log("Starting SASL PLAIN authentication"),this.send({command:"AUTHENTICATE",params:["PLAIN"]})):"sasl"==e&&this.params.saslExternal&&(console.log("Starting SASL EXTERNAL authentication"),this.send({command:"AUTHENTICATE",params:["EXTERNAL"]}))}));break;case"NAK":console.log("Server nak'ed caps:",s[0]),this.status!=Qe.Status.REGISTERED&&this.send({command:"CAP",params:["END"]})}}handleAuthenticate(e){let t=e.params[0];if("+"!=t)return this.dispatchEvent(new CustomEvent("error",{detail:"Expected an empty challenge, got: "+t})),void this.send({command:"AUTHENTICATE",params:["*"]});if(this.params.saslPlain){let e=btoa("\0"+this.params.saslPlain.username+"\0"+this.params.saslPlain.password);this.send({command:"AUTHENTICATE",params:[e]})}else{if(!this.params.saslExternal)throw new Error("Received AUTHENTICATE for unknown mechanism");this.send({command:"AUTHENTICATE",params:[btoa("")]})}}send(e){if(!this.ws)throw new Error("Failed to send IRC message "+e.command+": socket is closed");this.ws.send(function(e){let t="";if(e.tags&&Object.keys(e.tags).length>0&&(t+="@"+Fe(e.tags)+" "),e.prefix&&(t+=":"+function(e){let t=e.name;return e.user&&(t+="!"+e.user),e.host&&(t+="@"+e.host),t}(e.prefix)+" "),t+=e.command,e.params&&e.params.length>0){for(let s=0;s<e.params.length-1;s++)t+=" "+e.params[s];let s=String(e.params[e.params.length-1]);0===s.length||s.startsWith(":")||s.indexOf(" ")>=0?t+=" :"+s:t+=" "+s}return t}(e)),console.debug("Sent:",e)}setCaseMapping(e){this.cm=Le.byName(e),this.cm||(console.error("Unsupported case-mapping '"+e+"', falling back to RFC 1459"),this.cm=Le.RFC1459),this.pendingLists=new Me(this.pendingLists,this.cm),this.monitored=new Me(this.monitored,this.cm)}isServer(e){return"*"===e||this.cm(e)===this.cm(this.serverPrefix.name)}isMyNick(e){return this.cm(e)==this.cm(this.nick)}isChannel(e){return(this.isupport.get("CHANTYPES")||"#&+!").indexOf(e[0])>=0}setPingInterval(e){clearInterval(this.pingIntervalID),this.pingIntervalID=null,e<=0||(this.pingIntervalID=setInterval((()=>{this.ws&&this.send({command:"PING",params:["gamja"]})}),1e3*e))}roundtrip(e,t){let s;return this.enabledCaps["labeled-response"]&&(ze++,s=String(ze),e.tags={...e.tags,label:s}),new Promise(((n,r)=>{let a,i=e=>{let i,u=e.detail.message,o=function(e){if(e.tags.label)return e.tags.label;let t=e.batch;for(;t;){if(t.tags.label)return t.tags.label;t=t.parent}return null}(u);if(!o||o==s){try{i=t(u)}catch(e){a(),r(e)}i&&(a(),n(i))}},u=()=>{this.status===Qe.Status.DISCONNECTED&&(a(),r(new Error("Connection closed")))};a=()=>{this.removeEventListener("message",i),this.removeEventListener("status",u)},this.addEventListener("message",i),this.addEventListener("status",u),this.send(e)}))}fetchBatch(e,t){let s=null,n=[],r=e.command;return this.roundtrip(e,(e=>{if(s){let t=e.batch;for(;t;){if(t.name===s){n.push(e);break}t=t.parent}}switch(e.command){case"BATCH":let a=e.params[0].startsWith("+"),i=e.params[0].slice(1);if(a&&e.params[1]===t){s=i;break}if(!a&&i===s)return{...this.batches.get(i),messages:n};break;case"FAIL":if(e.params[0]===r)throw e}}))}roundtripChatHistory(e){let t=this.pendingCmds.CHATHISTORY.then((()=>{let t={command:"CHATHISTORY",params:e};return this.fetchBatch(t,"chathistory").then((e=>e.messages))}));return this.pendingCmds.CHATHISTORY=t.catch((()=>{})),t}chatHistoryPageSize(){if(this.isupport.has("CHATHISTORY")){let e=parseInt(this.isupport.get("CHATHISTORY"),10);if(e>0)return e}return 100}fetchHistoryBefore(e,t,s){let n=Math.min(s,this.chatHistoryPageSize()),r=["BEFORE",e,"timestamp="+t,n];return this.roundtripChatHistory(r).then((e=>({more:e.length>=n})))}fetchHistoryBetween(e,t,s,n){let r=Math.min(n,this.chatHistoryPageSize()),a=["AFTER",e,"timestamp="+t.time,r];return this.roundtripChatHistory(a).then((a=>{if((n-=a.length)<=0)throw new Error("Cannot fetch all chat history: too many messages");return a.length==r?(t.time=a[a.length-1].tags.time,this.fetchHistoryBetween(e,t,s,n)):null}))}fetchHistoryTargets(e,t){let s={command:"CHATHISTORY",params:["TARGETS","timestamp="+e,"timestamp="+t,1e3]};return this.fetchBatch(s,"draft/chathistory-targets").then((e=>e.messages.map((e=>{if("CHATHISTORY"!=e.command||"TARGETS"!=e.params[0])throw new Error("Cannot fetch chat history targets: unexpected message "+e);return{name:e.params[1],latestMessage:e.params[2]}}))))}listBouncerNetworks(){if(!this.enabledCaps["soju.im/bouncer-networks"])return Promise.reject(new Error("Server doesn't support the BOUNCER extension"));return this.fetchBatch({command:"BOUNCER",params:["LISTNETWORKS"]},"soju.im/bouncer-networks").then((e=>{let t=new Map;for(let s of e.messages){console.assert("BOUNCER"===s.command&&"NETWORK"===s.params[0]);let e=s.params[1],n=Se(s.params[2]);t.set(e,n)}return t}))}maxMonitorTargets(){if(!this.isupport.has("MONITOR"))return 0;let e=this.isupport.get("MONITOR");return""===e?1/0:parseInt(e,10)}monitor(e){this.monitored.has(e)||(this.monitored.set(e,!0),this.monitored.size+1>this.maxMonitorTargets()||this.send({command:"MONITOR",params:["+",e]}))}unmonitor(e){this.monitored.has(e)&&(this.monitored.delete(e),this.isupport.has("MONITOR")&&this.send({command:"MONITOR",params:["-",e]}))}createBouncerNetwork(e){let t={command:"BOUNCER",params:["ADDNETWORK",Fe(e)]};return this.roundtrip(t,(e=>{if("BOUNCER"===e.command&&"ADDNETWORK"===e.params[0])return e.params[1]}))}}function Ye(e,t){let s=R.find(e),n=[],r=0;s.forEach((s=>{if(!s.isLink)return;const a=e.substring(r,s.start);n.push(a),n.push(Ae`
			<a
				href=${s.href}
				target="_blank"
				rel="noreferrer noopener"
				onClick=${t}
			>${s.value}</a>
		`),r=s.end}));const a=e.substring(r);return n.push(a),n}R.options.defaults.defaultProtocol="https",R.registerCustomProtocol("irc"),R.registerCustomProtocol("ircs"),R.registerPlugin("ircChannel",(({scanner:e,parser:t,utils:s})=>{const{POUND:n,DOMAIN:r,TLD:a,LOCALHOST:i,UNDERSCORE:u,DOT:o,HYPHEN:l}=e.tokens,c=t.start,h=s.createTokenClass("ircChannel",{isLink:!0,toHref(){return"irc:///"+this.toString()}}),p=c.tt(n),m=p.tt(r,h);p.tt(a,m),p.tt(i,m),p.tt(n,m),m.tt(u,m),m.tt(r,m),m.tt(a,m),m.tt(i,m);const d=m.tt(o);d.tt(u,m),d.tt(r,m),d.tt(a,m),d.tt(i,m)}));function Je(e){return e>="0"&&e<="9"}function Ve(e){let t="";for(let s=0;s<e.length;s++){let n=e[s];switch(n){case"":case"":case"":case"":case"":case"":case"":break;case"":if(!Je(e[s+1]))break;s++,Je(e[s+1])&&s++,","==e[s+1]&&Je(e[s+2])&&(s+=2,Je(e[s+1])&&s++);break;case"":s+=6;break;default:t+=n}}return t}const Xe="server",Ze="channel",et="nick",tt=Qe.Status,st={NONE:"",MESSAGE:"message",HIGHLIGHT:"highlight",compare(e,t){const s={[st.NONE]:0,[st.MESSAGE]:1,[st.HIGHLIGHT]:2};return s[e]-s[t]},union:(e,t)=>st.compare(e,t)>0?e:t},nt="delivered",rt="read";function at(e){return"irc:///"+encodeURIComponent(e)+",isuser"}function it(e){return"irc:///"+encodeURIComponent(e)}function ut(e){switch(e.type){case Xe:return"irc:///";case Ze:return it(e.name);case et:return at(e.name)}throw new Error("Unknown buffer type: "+e.type)}function ot(e,t){let s=ut(e);return t.tags.msgid?s+"?msgid="+encodeURIComponent(t.tags.msgid):s+"?timestamp="+encodeURIComponent(t.tags.time)}function lt(e,t,s){let n=e.isupport.get("NETWORK");return t&&t.name&&t.name!==t.host?t.name:n||(t?t.name||t.host||"server":s?"bouncer":"server")}function ct(e,t){let s;if(s="function"==typeof t?t(e,e):t,e!==s&&s)return{...e,...s}}function ht(e){return e.type==Xe}function pt(e,t){return e.server!=t.server?e.server>t.server?1:-1:ht(e)!=ht(t)?ht(t)?1:-1:e.name!=t.name?e.name>t.name?1:-1:0}let mt=0,dt=0,ft=0;const Dt={create:()=>({servers:new Map,buffers:new Map,activeBuffer:null}),updateServer(e,t,s){let n=e.servers.get(t);if(!n)return;let r=ct(n,s);if(!r)return;let a=new Map(e.servers);return a.set(t,r),{servers:a}},updateBuffer(e,t,s){let n=Dt.getBuffer(e,t);if(!n)return;let r=ct(n,s);if(!r)return;let a=new Map(e.buffers);return a.set(n.id,r),{buffers:a}},getActiveServerID(e){let t=e.buffers.get(e.activeBuffer);return t?t.server:null},getBuffer(e,t){switch(typeof t){case"number":return e.buffers.get(t);case"object":if(t.id)return e.buffers.get(t.id);let s=t.server,n=t.name;s||(s=Dt.getActiveServerID(e)),n||(n="*");let r=Le.RFC1459,a=e.servers.get(s);a&&(r=Le.byName(a.isupport.get("CASEMAPPING"))||r);let i=r(n);for(let t of e.buffers.values())if(t.server===s&&r(t.name)===i)return t;return null;default:throw new Error("Invalid buffer ID type: "+typeof t)}},createServer(e){mt++;let t=mt,s=new Map(e.servers);return s.set(t,{id:t,status:tt.DISCONNECTED,isupport:new Map,users:new Me(null,Le.RFC1459)}),[t,{servers:s}]},createBuffer(e,t,s,n){let r=Dt.getBuffer(e,{server:s,name:t});if(r)return[r.id,null];dt++;let a,i=dt;a="*"==t?Xe:n.isChannel(t)?Ze:et;let u=Array.from(e.buffers.values());u.push({id:i,name:t,type:a,server:s,serverInfo:null,joined:!1,topic:null,members:new Me(null,n.cm),messages:[],unread:st.NONE,prevReadReceipt:null}),u=u.sort(pt);let o=new Map(u.map((e=>[e.id,e])));return[i,{buffers:o}]},handleMessage(e,t,s,n){function r(t){return Dt.updateServer(e,s,t)}function a(t,n){return Dt.updateBuffer(e,{server:s,name:t},n)}function i(e,t){return r((s=>{let n=new Me(s.users),r=ct(n.get(e),t);if(r)return n.set(e,r),{users:n}}))}if(He(t,"chathistory"))return;let u,o,l,c,h,p,m;switch(t.command){case"004":return a("*",{serverInfo:{name:t.params[1],version:t.params[2]}});case"005":return m=new Map(e.buffers),e.buffers.forEach((e=>{if(e.server!=s)return;let t=new Me(e.members,n.cm);m.set(e.id,{...e,members:t})})),{buffers:m,...r((e=>({isupport:new Map(n.isupport),users:new Me(e.users,n.cm)})))};case"331":return o=t.params[1],a(o,{topic:null});case"332":return o=t.params[1],l=t.params[2],a(o,{topic:l});case"333":break;case"366":return o=t.params[1],a(o,(e=>{let s=new Me(null,e.members.caseMap);return t.list.forEach((e=>{e.params[3].split(" ").forEach((e=>{let t=Oe(e);s.set(t.name,t.prefix)}))})),{members:s}}));case"352":case"354":return h=n.parseWhoReply(t),void 0!==h.flags&&(h.away=h.flags.indexOf("G")>=0,h.operator=h.flags.indexOf("*")>=0,delete h.flags),h.offline=!1,i(h.nick,h);case"315":if(u=t.params[1],0==t.list.length&&!n.isChannel(u)&&u.indexOf("*")<0)return i(u,(e=>({offline:!0})));break;case"JOIN":if(o=t.params[0],n.isMyNick(t.prefix.name)){let[t,r]=Dt.createBuffer(e,o,s,n);e={...e,...r}}return p=a(o,(e=>{let s=new Me(e.members);return s.set(t.prefix.name,""),{members:s,joined:e.joined||n.isMyNick(t.prefix.name)}})),e={...e,...p},h={nick:t.prefix.name,offline:!1},t.prefix.user&&(h.username=t.prefix.user),t.prefix.host&&(h.hostname=t.prefix.host),t.params.length>2&&(h.account=t.params[1],"*"===h.account&&(h.account=null),h.realname=t.params[2]),p=i(t.prefix.name,h),e={...e,...p};case"PART":return o=t.params[0],a(o,(e=>{let s=new Me(e.members);return s.delete(t.prefix.name),{members:s,joined:e.joined&&!n.isMyNick(t.prefix.name)}}));case"KICK":o=t.params[0];let d=t.params[1];return a(o,(e=>{let t=new Me(e.members);return t.delete(d),{members:t}}));case"QUIT":return m=new Map(e.buffers),e.buffers.forEach((e=>{if(e.server!=s)return;if(!e.members.has(t.prefix.name))return;let n=new Me(e.members);n.delete(t.prefix.name),m.set(e.id,{...e,members:n})})),e={...e,buffers:m},p=i(t.prefix.name,(e=>{if(e)return{offline:!0}})),e={...e,...p};case"NICK":let f=t.params[0];return m=new Map(e.buffers),e.buffers.forEach((e=>{if(e.server!=s)return;if(!e.members.has(t.prefix.name))return;let n=new Me(e.members);n.set(f,n.get(t.prefix.name)),n.delete(t.prefix.name),m.set(e.id,{...e,members:n})})),e={...e,buffers:m},p=r((e=>{let s=new Me(e.users),n=s.get(t.prefix.name);if(n)return s.set(f,n),s.delete(t.prefix.name),{users:s}})),e={...e,...p};case"SETNAME":return i(t.prefix.name,{realname:t.params[0]});case"CHGHOST":return i(t.prefix.name,{username:t.params[0],hostname:t.params[1]});case"ACCOUNT":let D=t.params[0];return"*"===D&&(D=null),i(t.prefix.name,{account:D});case"AWAY":let g=t.params[0];return i(t.prefix.name,{away:!!g});case"TOPIC":return o=t.params[0],l=t.params[1],a(o,{topic:l});case"MODE":if(u=t.params[0],!n.isChannel(u))return;let b=n.isupport.get("PREFIX")||"",C=new Map(je(b).map((e=>[e.mode,e.prefix])));return a(u,(e=>{let s=new Me(e.members);return function(e,t,s){let n=t.get("CHANMODES")||"beI,k,l,imnst",r=t.get("PREFIX")||"",a=new Map,[i,u,o,l]=n.split(",");if(Array.from(i).forEach((e=>a.set(e,"A"))),Array.from(u).forEach((e=>a.set(e,"B"))),Array.from(o).forEach((e=>a.set(e,"C"))),Array.from(l).forEach((e=>a.set(e,"D"))),je(r).forEach((e=>a.set(e.mode,"B"))),"MODE"!==e.command)throw new Error("Expected a MODE message");let c=e.params[1],h=e.params.slice(2),p=null,m=0;for(let e=0;e<c.length;e++){if("+"===c[e]||"-"===c[e]){p=c[e];continue}if(!p)throw new Error("malformed mode string: missing plus/minus");let t=c[e],n="+"===p,r=a.get(t);if(!r)continue;let i=null;("A"===r||"B"===r||"C"===r&&n)&&(i=h[m],m++),s(t,n,i)}}(t,n.isupport,((e,t,r)=>{if(C.has(e)){let a=r,i=s.get(a),u=C.get(e);s.set(a,function(e,t,s,n){let r=n.isupport.get("PREFIX")||"",a=new Map(je(r).map(((e,t)=>[e.prefix,t])));s?e.indexOf(t)<0&&(e+=t,e=Array.from(e).sort(((e,t)=>a.get(e)-a.get(t))).join("")):e=e.replace(t,"");return e}(i,u,t,n))}})),{members:s}}));case"730":c=t.params[1].split(",");for(let t of c){let s=i(Ne(t).name,{offline:!1});e={...e,...s}}return e;case"731":c=t.params[1].split(",");for(let t of c){let s=i(Ne(t).name,{offline:!0});e={...e,...s}}return e}},addMessage:(e,t,s)=>(ft++,t.key=ft,Dt.updateBuffer(e,s,(e=>{let s=function(e,t){if(0==e.length)return[t];if(!He(t,"chathistory")||e[e.length-1].tags.time<=t.tags.time)return e.concat(t);let s=-1;for(let n=0;n<e.length;n++){let r=e[n];if(t.tags.time<r.tags.time){s=n;break}}return console.assert(s>=0,""),(e=[...e]).splice(s,0,t),e}(e.messages,t);return{messages:s}})))};class gt{constructor(e){this.k="gamja_"+e}load(){let e=localStorage.getItem(this.k);return e?JSON.parse(e):null}put(e){e?localStorage.setItem(this.k,JSON.stringify(e)):localStorage.removeItem(this.k)}}const bt=new gt("autoconnect"),Ct=new gt("naggedProtocolHandler"),Et=new gt("receipts"),vt={load(){let e=Et.load();return new Map(Object.entries(e||{}))},put(e){Et.put(Object.fromEntries(e))}};class kt{raw=new gt("buffers");m=null;constructor(){let e=this.raw.load();this.m=new Map(Object.entries(e||{}))}key(e){return JSON.stringify({name:e.name,server:{url:e.server.url,nick:e.server.nick,bouncerNetwork:e.server.bouncerNetwork}})}save(){this.m.size>0?this.raw.put(Object.fromEntries(this.m)):this.raw.put(null)}get(e){return this.m.get(this.key(e))}put(e){let t=this.key(e),s=this.m.get(t);s&&s.unread===e.unread||(this.m.set(this.key(e),{name:e.name,unread:e.unread,server:{url:e.server.url,nick:e.server.nick,bouncerNetwork:e.server.bouncerNetwork}}),this.save())}delete(e){this.m.delete(this.key(e)),this.save()}list(e){let t=[];for(const s of this.m.values())s.server.url===e.url&&s.server.nick===e.nick&&s.server.bouncerNetwork===e.bouncerNetwork&&t.push(s);return t}clear(e){if(e)for(const e of this.m.values())this.m.delete(this.key(e));else this.m=new Map;this.save()}}const At={"~":"owner","&":"admin","@":"op","%":"halfop","+":"voice"};function wt(e){if(!this.props.value)return null;const t=At[this.props.value[0]]||"";return Ae`
		<span class="membership ${t}" title=${t}>
			${this.props.value}
		</span>
	`}function yt(e){let t=function(e){let t=5381;for(let s=0;s<e.length;s++)t=(t<<5)+t+e.charCodeAt(s),t>>>=0;return t}(e.nick)%16+1;return Ae`
		<a href=${at(e.nick)} class="nick nick-${t}" onClick=${function(t){t.preventDefault(),e.onClick()}}>${e.nick}</a>
	`}function St({date:e,url:t}){if(!e)return Ae`<spam class="timestamp">--:--:--</span>`;let s=`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`;return Ae`
		<a
			href=${t}
			class="timestamp"
			title=${e.toLocaleString()}
			onClick=${e=>e.preventDefault()}
		>
			${s}
		</a>
	`}class Ft extends f{shouldComponentUpdate(e){return this.props.message!==e.message}render(){let e=this.props.message,t=this.props.buffer,s=this.props.server,n=this.props.onNickClick,r=this.props.onChannelClick;function a(e){return Ae`
				<${yt} nick=${e} onClick=${()=>n(e)}/>
			`}let i,u,o,l="";switch(e.command){case"NOTICE":case"PRIVMSG":o=e.params[0];let n=e.params[1],c=Re(e);if(c)"ACTION"==c.command?(l="me-tell",i=Ae`* ${a(e.prefix.name)} ${Ye(Ve(c.param),r)}`):i=Ae`
						${a(e.prefix.name)} has sent a CTCP command: ${c.command} ${c.param}
					`;else{l="talk";let t="<",s=">";"NOTICE"==e.command&&(t=s="-"),i=Ae`${t}${a(e.prefix.name)}${s} ${Ye(Ve(n),r)}`}let h=s.isupport.get("STATUSMSG");if(o!==t.name&&h){let e=Oe(o,h);e.name===t.name&&(i=[Ae`(<${wt} value=${e.prefix}/>)`," ",i])}e.isHighlight&&(l+=" highlight");break;case"JOIN":i=Ae`
				${a(e.prefix.name)} has joined
			`;break;case"PART":i=Ae`
				${a(e.prefix.name)} has left
			`;break;case"QUIT":i=Ae`
				${a(e.prefix.name)} has quit
			`;break;case"NICK":let p=e.params[0];i=Ae`
				${a(e.prefix.name)} is now known as ${a(p)}
			`;break;case"KICK":i=Ae`
				${a(e.params[1])} was kicked by ${a(e.prefix.name)} (${e.params.slice(2)})
			`;break;case"MODE":o=e.params[0],i=Ae`
				* ${a(e.prefix.name)} sets mode ${e.params.slice(1).join(" ")}
			`,t.name!==o&&(i=Ae`${i} on ${o}`);break;case"TOPIC":let m=e.params[1];i=Ae`
				${a(e.prefix.name)} changed the topic to: ${Ye(Ve(m),r)}
			`;break;case"INVITE":u=e.params[0];let d=e.params[1];t.type===Xe?(l="talk",i=Ae`
					You have been invited to ${function(e){return Ae`
				<a href=${it(e)} onClick=${function(t){t.preventDefault(),r(e)}}>
					${e}
				</a>
			`}(d)} by ${a(e.prefix.name)}
				`):i=Ae`
					${a(e.prefix.name)} has invited ${a(u)} to the channel
				`;break;case"001":let f=e.params[0];i=Ae`Connected to server, your nickname is ${f}`;break;case"341":u=e.params[1],i=Ae`${a(u)} has been invited to the channel`;break;case"372":l="motd",i=Ye(Ve(e.params[1]),r);break;case"900":let D=e.params[2];i=Ae`You are now authenticated as ${D}`;break;case"901":i=Ae`You are now unauthenticated`;break;case"221":let g=e.params[1];i=g?Ae`Your user mode is ${g}`:Ae`You have no user mode`;break;case"324":i=Ae`Channel mode is ${e.params.slice(2).join(" ")}`;break;case"329":let b=new Date(1e3*parseInt(e.params[2],10));i=Ae`Channel was created on ${b.toLocaleString()}`;break;default:xe(e.command)&&"422"!=e.command&&(l="error"),i=Ae`${e.command} ${e.params.join(" ")}`}return Ae`
			<div class="logline ${l}" data-key=${e.key}>
				<${St} date=${new Date(e.tags.time)} url=${ot(t,e)}/>
				${" "}
				${i}
			</div>
		`}}class Nt extends f{shouldComponentUpdate(e){return this.props.messages[0]!==e.messages[0]||this.props.messages[this.props.messages.length-1]!==e.messages[e.messages.length-1]}render(){let e=this.props.messages,t=this.props.buffer,s=this.props.onNickClick;function n(e){return Ae`
				<${yt} nick=${e} onClick=${()=>s(e)}/>
			`}let r={JOIN:[],PART:[],QUIT:[],NICK:[]};e.forEach((e=>{r[e.command].push(e)}));let a=!0,i=[];["JOIN","PART","QUIT"].forEach((e=>{if(0===r[e].length)return;let t,s=new Set(r[e].map((e=>e.prefix.name))),u=s.size>1;switch(e){case"JOIN":t=u?"have joined":"has joined";break;case"PART":t=u?"have left":"has left";break;case"QUIT":t=u?"have quit":"has quit"}a?a=!1:i.push(", "),i.push(function(e,t){if(0===e.length)return null;if(1===e.length)return t(e[0]);let s=e.slice(0,e.length-1).map(((e,s)=>0===s?t(e):[", ",t(e)]));return s.push(" and "),s.push(t(e[e.length-1])),s}([...s],n)),i.push(" "+t)})),r.NICK.forEach((e=>{a?a=!1:i.push(", ");let t=e.params[0];i.push(Ae`
				${n(e.prefix.name)} is now known as ${n(t)}
			`)}));let u=e[e.length-1],o=new Date(e[0].tags.time),l=new Date(u.tags.time),c=Ae`
			<${St} date=${o} url=${ot(t,e[0])}/>
		`;return l-o>6e3&&(c=[c," — ",Ae`
					<${St} date=${l} url=${ot(t,u)}/>
				`]),Ae`
			<div class="logline" data-key=${e[0].key}>
				${c}
				${" "}
				${i}
			</div>
		`}}let Bt=!1;if(window.Notification&&(Bt=!0,"default"===Notification.permission))try{new Notification("")}catch(e){"TypeError"===e.name&&(Bt=!1)}class Ot extends f{state={nag:!1};constructor(e){super(e),this.handleClick=this.handleClick.bind(this),this.state.nag=this.shouldNag()}shouldNag(){return Bt&&"default"===Notification.permission}handleClick(e){e.preventDefault(),Notification.requestPermission((e=>{this.setState({nag:this.shouldNag()})}))}render(){return this.state.nag?Ae`
			<div class="logline">
				<${St}/>
				${" "}
				<a href="#" onClick=${this.handleClick}>Turn on desktop notifications</a> to get notified about new messages
			</div>
		`:null}}class _t extends f{state={nag:!0};constructor(e){super(e),this.handleClick=this.handleClick.bind(this),this.state.nag=!Ct.load()}handleClick(e){e.preventDefault();let t=window.location.origin+window.location.pathname+"?open=%s";try{navigator.registerProtocolHandler("irc",t),navigator.registerProtocolHandler("ircs",t)}catch(e){console.error("Failed to register protocol handler: ",e)}Ct.put(!0),this.setState({nag:!1})}render(){if(!navigator.registerProtocolHandler||!this.state.nag)return null;let e=this.props.bouncerName||"this bouncer";return Ae`
			<div class="logline">
				<${St}/>
				${" "}
				<a href="#" onClick=${this.handleClick}>Register our protocol handler</a> to open IRC links with ${e}
			</div>
		`}}class Tt extends f{constructor(e){super(e)}shouldComponentUpdate(e){return this.props.date.getTime()!==e.date.getTime()}render(){let e=this.props.date,t=e.getFullYear().toString().padStart(4,"0"),s=(e.getMonth()+1).toString().padStart(2,"0"),n=e.getDate().toString().padStart(2,"0");return Ae`
			<div class="separator date-separator">
				${`${t}-${s}-${n}`}
			</div>
		`}}function xt(e){return Ae`<div class="separator unread-separator">New messages</div>`}class $t extends f{shouldComponentUpdate(e){return this.props.buffer!==e.buffer}render(){let e=this.props.buffer,t=this.props.server;if(!e)return null;let s=[];if(e.type==Xe&&s.push(Ae`<${Ot}/>`),e.type==Xe&&this.props.isBouncer&&!t.isupport.has("BOUNCER_NETID")){let e=t.isupport.get("NETWORK");s.push(Ae`<${_t} bouncerName=${e}/>`)}let n=this.props.onChannelClick,r=this.props.onNickClick;function a(s){return Ae`
				<${Ft}
					key=${"msg-"+s.key}
					message=${s}
					buffer=${e}
					server=${t}
					onChannelClick=${n}
					onNickClick=${r}
				/>
			`}function i(s){let n=new Map,i=[];return s.forEach(((e,t)=>{"PART"!==e.command&&"QUIT"!==e.command||n.set(e.prefix.name,t),"JOIN"===e.command&&n.has(e.prefix.name)?(i[n.get(e.prefix.name)]=!1,n.delete(e.prefix.name),i.push(!1)):i.push(!0)})),0===(s=s.filter(((e,t)=>i[t]))).length?null:1===s.length?a(s[0]):Ae`
				<${Nt}
					key=${"fold-"+s[0].key+"-"+s[s.length-1].key}
					messages=${s}
					buffer=${e}
					server=${t}
					onNickClick=${r}
				/>
			`}let u=!1,o=new Date,l=[];return e.messages.forEach((t=>{let n=[];!u&&e.type!=Xe&&e.prevReadReceipt&&t.tags.time>e.prevReadReceipt.time&&(n.push(Ae`<${xt} key="unread"/>`),u=!0);let r=new Date(t.tags.time);var c,h;h=r,((c=o).getFullYear()!==h.getFullYear()||c.getMonth()!==h.getMonth()||c.getDate()!==h.getDate())&&n.push(Ae`<${Tt} key=${"date-"+r} date=${r}/>`),o=r,n.length>0&&(s.push(i(l)),s.push(n),l=[]),function(e){switch(e.command){case"JOIN":case"PART":case"QUIT":case"NICK":return!0}return!1}(t)?l.push(t):(l.length>0&&(s.push(i(l)),l=[]),s.push(a(t)))})),s.push(i(l)),Ae`
			<div class="logline-list">
				${s}
			</div>
		`}}function Rt(e){let t=e.buffer.name;e.buffer.type==Xe&&(t=lt(e.server,e.bouncerNetwork,e.isBouncer));let s=["type-"+e.buffer.type];return e.active&&s.push("active"),e.buffer.unread!=st.NONE&&s.push("unread-"+e.buffer.unread),Ae`
		<li class="${s.join(" ")}">
			<a
				href=${ut(e.buffer)}
				onClick=${function(t){t.preventDefault(),e.onClick()}}
				onMouseDown=${function(t){1===t.button&&(t.preventDefault(),e.onClose())}}
			>${t}</a>
		</li>
	`}function It(e){let t=Array.from(e.buffers.values()).map((t=>{let s=e.servers.get(t.server),n=null,r=s.isupport.get("BOUNCER_NETID");return r&&(n=e.bouncerNetworks.get(r)),Ae`
			<${Rt}
				key=${t.id}
				buffer=${t}
				server=${s}
				isBouncer=${e.isBouncer}
				bouncerNetwork=${n}
				onClick=${()=>e.onBufferClick(t)}
				onClose=${()=>e.onBufferClose(t)}
				active=${e.activeBuffer==t.id}
			/>
		`}));return Ae`<ul>${t}</ul>`}const Lt="here",Pt="gone",Mt="offline";function jt(e){let t={[Lt]:"User is online",[Pt]:"User is away",[Mt]:"User is offline"}[e.status];return Ae`<span class="status status-${e.status}" title=${t}>●</span>`}function Ht(e){function t(t){t.preventDefault(),e.onClose()}function s(t){t.preventDefault(),e.onJoin()}let n=null,r=null;switch(e.buffer.type){case Xe:switch(e.server.status){case tt.DISCONNECTED:n="Disconnected";break;case tt.CONNECTING:n="Connecting...";break;case tt.REGISTERING:n="Logging in...";break;case tt.REGISTERED:if(e.bouncerNetwork)switch(e.bouncerNetwork.state){case"disconnected":n="Bouncer disconnected from network";break;case"connecting":n="Bouncer connecting to network...";break;case"connected":n=`Connected to ${e.bouncerNetwork.host||"network"}`}else if(e.buffer.serverInfo){n=`Connected to ${e.buffer.serverInfo.name}`}else n="Connected"}r=e.isBouncer?e.server.isupport.get("BOUNCER_NETID")?Ae`
					<button
						key="join"
						onClick=${s}
					>Join channel</button>
					<button
						key="manage"
						onClick=${function(t){t.preventDefault(),e.onManageNetwork()}}
					>Manage network</button>
				`:Ae`
					<button
						key="add"
						onClick=${function(t){t.preventDefault(),e.onAddNetwork()}}
					>Add network</button>
					<button
						key="disconnect"
						class="danger"
						onClick=${t}
					>Disconnect</button>
				`:Ae`
				<button
					key="join"
					onClick=${s}
				>Join channel</button>
				<button
					key="disconnect"
					class="danger"
					onClick=${t}
				>Disconnect</button>
			`;break;case Ze:e.buffer.topic&&(n=Ye(Ve(e.buffer.topic),e.onChannelClick)),r=e.buffer.joined?Ae`
				<button
					key="part"
					class="danger"
					onClick=${t}
				>Leave</button>
			`:Ae`
				<button
					key="join"
					onClick=${s}
				>Join</button>
				<button
					key="part"
					class="danger"
					onClick=${t}
				>Close</button>
			`;break;case et:if(e.user){let t=Lt;e.user.offline?t=Mt:e.user.away&&(t=Pt);let s=e.buffer.name;Ue(e.user.realname,e.buffer.name)&&(s=Ve(e.user.realname||""));let r=[];if(e.user.username&&e.user.hostname&&r.push(`${e.user.username}@${e.user.hostname}`),e.user.account){let t,s=`This user is verified and has logged in to the server with the account ${e.user.account}.`;t=e.user.account===e.buffer.name?"authenticated":`authenticated as ${e.user.account}`,r.push(Ae`<abbr title=${s}>${t}</abbr>`)}else if(e.server.isupport.has("MONITOR")&&e.server.isupport.has("WHOX")){let e="This user has not been verified and is not logged in.";r.push(Ae`<abbr title=${e}>unauthenticated</abbr>`)}if(e.user.operator){let e="This user is a server operator, they have administrator privileges.";r.push(Ae`<abbr title=${e}>server operator</abbr>`)}r=r.map(((e,t)=>0===t?e:[", ",e])),r.length>0&&(r=["(",r,")"]),n=Ae`<${jt} status=${t}/> ${s} ${r}`}r=Ae`
			<button
				key="close"
				class="danger"
				onClick=${t}
			>Close</button>
		`}let a=e.buffer.name;return e.buffer.type==Xe&&(a=lt(e.server,e.bouncerNetwork,e.isBouncer)),Ae`
		<div class="title">${a}</div>
		${n?Ae`<div class="description">${n}</div>`:null}
		<div class="actions">${r}</div>
	`}class Ut extends f{constructor(e){super(e),this.handleClick=this.handleClick.bind(this)}shouldComponentUpdate(e){return this.props.nick!==e.nick||this.props.membership!==e.membership}handleClick(e){e.preventDefault(),this.props.onClick()}render(){const e={"~":"owner","&":"admin","@":"op","%":"halfop","+":"voice"}[this.props.membership[0]]||"";let t="";this.props.membership&&Ae`
				<span class="membership ${e}" title=${e}>
					${this.props.membership}
				</span>
			`;let s=null,n=this.props.user;if(n){let e="";n.username&&n.hostname&&(e=`${n.username}@${n.hostname}`),Ue(n.realname,this.props.nick)?(s=Ve(n.realname),e&&(s=`${s} (${e})`)):s=e,n.account&&(s+=`\nAuthenticated as ${n.account}`)}return Ae`
			<li>
				<a
					href=${at(this.props.nick)}
					class="nick"
					title=${s}
					onClick=${this.handleClick}
				>
					<${wt} value=${this.props.membership}/>
					${this.props.nick}
				</a>
			</li>
		`}}function Kt(e,t){let[s,n]=e,[r,a]=t;const i=["~","&","@","%","+"];let u=i.indexOf(n[0]),o=i.indexOf(a[0]);return u<0&&(u=i.length),o<0&&(o=i.length),u!==o?u-o:s<r?-1:1}class Wt extends f{shouldComponentUpdate(e){return this.props.members!==e.members}render(){return Ae`
			<ul>
				${Array.from(this.props.members).sort(Kt).map((([e,t])=>Ae`
					<${Ut}
						key=${e}
						nick=${e}
						membership=${t}
						user=${this.props.users.get(e)}
						onClick=${()=>this.props.onNickClick(e)}
					/>
				`))}
			</ul>
		`}}class Gt extends f{state={url:"",pass:"",nick:"",password:"",rememberMe:!1,username:"",realname:"",autojoin:""};nickInput={current:null};constructor(e){super(e),this.handleChange=this.handleChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this),e.params&&(this.state={...this.state,url:e.params.url||"",nick:e.params.nick||"",rememberMe:e.params.autoconnect||!1,username:e.params.username||"",realname:e.params.realname||"",autojoin:(e.params.autojoin||[]).join(",")})}handleChange(e){let t=e.target,s="checkbox"==t.type?t.checked:t.value;this.setState({[t.name]:s})}handleSubmit(e){if(e.preventDefault(),this.props.connecting)return;let t={url:this.state.url,pass:this.state.pass,nick:this.state.nick,autoconnect:this.state.rememberMe,username:this.state.username,realname:this.state.realname,saslPlain:null,autojoin:[]};this.state.password?t.saslPlain={username:t.username||t.nick,password:this.state.password}:"external"===this.props.auth&&(t.saslExternal=!0),this.state.autojoin.split(",").forEach((function(e){(e=e.trim())&&t.autojoin.push(e)})),this.props.onSubmit(t)}componentDidMount(){this.nickInput.current&&this.nickInput.current.focus()}render(){let e=this.props.connecting,t=null;this.props.params&&this.props.params.url||(t=Ae`
				<label>
					Server URL:<br/>
					<input
						type="text"
						name="url"
						value=${this.state.url}
						disabled=${e}
						inputmode="url"
					/>
				</label>
				<br/><br/>
			`);let s=null;this.props.connecting?s=Ae`
				<p>Connecting...</p>
			`:this.props.error&&(s=Ae`
				<p class="error-text">${this.props.error}</p>
			`);let n=null;"disabled"!==this.props.auth&&"external"!==this.props.auth&&(n=Ae`
				<label>
					Password:<br/>
					<input
						type="password"
						name="password"
						value=${this.state.password}
						disabled=${e}
						required=${"mandatory"===this.props.auth}
						placeholder=${"mandatory"!==this.props.auth?"(optional)":""}
					/>
				</label>
				<br/><br/>
			`);let r=Ae`
			<label>
				Auto-join channels:<br/>
				<input
					type="text"
					name="autojoin"
					value=${this.state.autojoin}
					disabled=${e}
					placeholder="Comma-separated list of channels"
				/>
			</label>
			<br/>
		`,a=0===(this.props.params.autojoin||[]).length;return Ae`
			<form onChange=${this.handleChange} onSubmit=${this.handleSubmit}>
				<h2>Connect to IRC</h2>

				<label>
					Nickname:<br/>
					<input
						type="username"
						name="nick"
						value=${this.state.nick}
						disabled=${e}
						ref=${this.nickInput}
						required
					/>
				</label>
				<br/><br/>

				${n}

				${a?null:[r,Ae`<br/>`]}

				<label>
					<input
						type="checkbox"
						name="rememberMe"
						checked=${this.state.rememberMe}
						disabled=${e}
					/>
					Remember me
				</label>
				<br/><br/>

				<details>
					<summary role="button">Advanced options</summary>

					<br/>

					${t}

					<label>
						Username:<br/>
						<input
							type="username"
							name="username"
							value=${this.state.username}
							disabled=${e}
							placeholder="Same as nickname"
						/>
					</label>
					<br/><br/>

					<label>
						Real name:<br/>
						<input
							type="text"
							name="realname"
							value=${this.state.realname}
							disabled=${e}
							placeholder="Same as nickname"
						/>
					</label>
					<br/><br/>

					<label>
						Server password:<br/>
						<input
							type="text"
							name="pass"
							value=${this.state.pass}
							disabled=${e}
							placeholder="None"
						/>
					</label>
					<br/><br/>

					${a?r:null}
				</details>

				<br/>
				<button disabled=${e}>Connect</button>

				${s}
			</form>
		`}}class zt extends f{state={channel:"#"};constructor(e){super(e),this.handleChange=this.handleChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this),e.channel&&(this.state.channel=e.channel)}handleChange(e){let t=e.target,s="checkbox"==t.type?t.checked:t.value;this.setState({[t.name]:s})}handleSubmit(e){e.preventDefault();let t={channel:this.state.channel};this.props.onSubmit(t)}render(){return Ae`
			<form onChange=${this.handleChange} onSubmit=${this.handleSubmit}>
				<label>
					Channel:<br/>
					<input type="text" name="channel" value=${this.state.channel} autofocus required/>
				</label>
				<br/>

				<br/>
				<button>Join</button>
			</form>
		`}}function qt(e,t,s){let n=Array.from(e.values()),r=n.findIndex((e=>e.id===t));return r<0?null:(r=(r+n.length+s)%n.length,n[r])}const Qt=[{key:"h",altKey:!0,description:"Mark all messages as read",execute:e=>{e.setState((t=>{let s=new Map;return t.buffers.forEach((t=>{if(t.messages.length>0){let s=t.messages[t.messages.length-1];e.setReceipt(t.name,rt,s)}s.set(t.id,{...t,unread:st.NONE,prevReadReceipt:null});let n=e.clients.get(t.server);e.bufferStore.put({name:t.name,server:n.params,unread:st.NONE})})),{buffers:s}}))}},{key:"a",altKey:!0,description:"Jump to next buffer with activity",execute:e=>{let t=null,s=null;for(let n of e.state.buffers.values())t||n.type!==Xe||(t=n),n.unread!==st.NONE&&(!s||st.compare(n.unread,s.unread)>0)&&(s=n);s||(s=t),s&&e.switchBuffer(s)}},{key:"ArrowUp",altKey:!0,description:"Jump to the previous buffer",execute:e=>{let t=qt(e.state.buffers,e.state.activeBuffer,-1);t&&e.switchBuffer(t)}},{key:"ArrowDown",altKey:!0,description:"Jump to the next buffer",execute:e=>{let t=qt(e.state.buffers,e.state.activeBuffer,1);t&&e.switchBuffer(t)}}];function Yt(e){let t=e.state.buffers.get(e.state.activeBuffer);if(!t)throw new Error("Not connected to server");return e.clients.get(t.server)}function Jt(e){let t=e.state.buffers.get(e.state.activeBuffer);if(!t||t.type!==Ze)throw new Error("Not in a channel");return t.name}function Vt(e,t,s){let n=t[0];if(!n)throw new Error("Missing nick");let r=Jt(e),a=Yt(e);a.whois(n).then((e=>{const t=e[311].params,n=t[2],i=t[3];a.send({command:"MODE",params:[r,s,`*!${n}@${i}`]})}))}function Xt(e){let t=e.state.buffers.get(e.state.activeBuffer);t&&t.type!==Xe&&e.setBufferState({server:t.server},(e=>({unread:st.union(e.unread,st.MESSAGE)})))}const Zt={usage:"<name>",description:"Join a channel",execute:(e,t)=>{let s=t[0];if(!s)throw new Error("Missing channel name");e.open(s)}},es={usage:"<nick>",description:"Remove a user from the channel",execute:(e,t)=>{let s=t[0],n=[Jt(e),s];t.length>1&&n.push(t.slice(1).join(" ")),Yt(e).send({command:"KICK",params:n})}};function ts(e,t,s){let n=t[0];if(!n)throw new Error("Missing nick");let r=Jt(e);Yt(e).send({command:"MODE",params:[r,s,n]})}var ss={ban:{usage:"[nick]",description:"Ban a user from the channel, or display the current ban list",execute:(e,t)=>{if(0!=t.length)return Vt(e,t,"+b");{let t=Jt(e);Yt(e).send({command:"MODE",params:[t,"+b"]})}}},buffer:{usage:"<name>",description:"Switch to a buffer",execute:(e,t)=>{let s=t[0];for(let t of e.state.buffers.values())if(t.name===s)return void e.switchBuffer(t);throw new Error("Unknown buffer")}},close:{description:"Close the current buffer",execute:(e,t)=>{let s=e.state.buffers.get(e.state.activeBuffer);if(!s||s.type==Xe)throw new Error("Not in a user or channel buffer");e.close(s.id)}},deop:{usage:"<nick>",description:"Remove operator status for a user on this channel",execute:(e,t)=>ts(e,t,"-o")},devoice:{usage:"<nick>",description:"Remove voiced status for a user on this channel",execute:(e,t)=>ts(e,t,"-v")},disconnect:{description:"Disconnect from the server",execute:(e,t)=>{e.disconnect()}},help:{description:"Show help menu",execute:(e,t)=>{e.openHelp()}},invite:{usage:"<nick>",description:"Invite a user to the channel",execute:(e,t)=>{let s=t[0];if(!s)throw new Error("Missing nick");let n=Jt(e);Yt(e).send({command:"INVITE",params:[s,n]})}},j:Zt,join:Zt,kick:es,kickban:{usage:"<target>",description:"Ban a user and removes them from the channel",execute:(e,t)=>{es.execute(e,t),ban.execute(e,t)}},lusers:{usage:"[<mask> [<target>]]",description:"Request user statistics about the network",execute:(e,t)=>{Yt(e).send({command:"LUSERS",params:t}),Xt(e)}},me:{usage:"<action>",description:"Send an action message to the current buffer",execute:(e,t)=>{let s=t.join(" "),n=function(e){let t=e.state.buffers.get(e.state.activeBuffer);if(!t)throw new Error("Not in a buffer");return t.name}(e),r=`ACTION ${s}`;e.privmsg(n,r)}},mode:{usage:"[target] [modes] [mode args...]",description:"Query or change a channel or user mode",execute:(e,t)=>{let s=t[0];if(!s||s.startsWith("+")||s.startsWith("-")){t=[Jt(e),...t]}Yt(e).send({command:"MODE",params:t})}},motd:{usage:"[server]",description:"Get the Message Of The Day",execute:(e,t)=>{Yt(e).send({command:"MOTD",params:t}),Xt(e)}},msg:{usage:"<target> <message>",description:"Send a message to a nickname or a channel",execute:(e,t)=>{let s=t[0],n=t.slice(1).join(" ");Yt(e).send({command:"PRIVMSG",params:[s,n]})}},nick:{usage:"<nick>",description:"Change current nickname",execute:(e,t)=>{let s=t[0];Yt(e).send({command:"NICK",params:[s]})}},notice:{usage:"<target> <message>",description:"Send a notice to a nickname or a channel",execute:(e,t)=>{let s=t[0],n=t.slice(1).join(" ");Yt(e).send({command:"NOTICE",params:[s,n]})}},op:{usage:"<nick>",description:"Give a user operator status on this channel",execute:(e,t)=>ts(e,t,"+o")},part:{usage:"[reason]",description:"Leave a channel",execute:(e,t)=>{let s=t.join(" "),n=[Jt(e)];s&&n.push(s),Yt(e).send({command:"PART",params:n})}},query:{usage:"<nick> [message]",description:"Open a buffer to send messages to a nickname",execute:(e,t)=>{let s=t[0];if(!s)throw new Error("Missing nickname");if(e.open(s),t.length>1){let n=t.slice(1).join(" ");e.privmsg(s,n)}}},quiet:{usage:"[nick]",description:"Quiet a user in the channel, or display the current quiet list",execute:(e,t)=>{if(0!=t.length)return Vt(e,t,"+q");Yt(e).send({command:"MODE",params:[Jt(e),"+q"]})}},quit:{description:"Quit",execute:(e,t)=>{e.close({name:"*"})}},quote:{usage:"<command>",description:"Send a raw IRC command to the server",execute:(e,t)=>{let s;try{s=Be(t.join(" "))}catch(e){throw new Error("Failed to parse IRC command: "+e.message)}Yt(e).send(s)}},reconnect:{description:"Reconnect to the server",execute:(e,t)=>{e.reconnect()}},setname:{usage:"<realname>",description:"Change current realname",execute:(e,t)=>{let s=t.join(" "),n=Yt(e);if(!n.enabledCaps.setname)throw new Error("Server doesn't support changing the realname");n.send({command:"SETNAME",params:[s]})}},stats:{usage:"<query> [server]",description:"Request server statistics",execute:(e,t)=>{let s=t[0];if(!s)throw new Error("Missing query");let n=[s];t.length>1&&n.push(t.slice(1).join(" ")),Yt(e).send({command:"STATS",params:n}),Xt(e)}},topic:{usage:"<topic>",description:"Change the topic of the current channel",execute:(e,t)=>{let s=[Jt(e)];t.length>0&&s.push(t.join(" ")),Yt(e).send({command:"TOPIC",params:s})}},unban:{usage:"<nick>",description:"Remove a user from the ban list",execute:(e,t)=>Vt(e,t,"-b")},unquiet:{usage:"<nick>",description:"Remove a user from the quiet list",execute:(e,t)=>Vt(e,t,"-q")},unvoice:{usage:"<nick>",description:"Remove a user from the voiced list",execute:(e,t)=>ts(e,t,"-v")},voice:{usage:"<nick>",description:"Give a user voiced status on this channel",execute:(e,t)=>ts(e,t,"+v")},who:{usage:"[<mask> [o]]",description:"Retrieve a list of users",execute:(e,t)=>{Yt(e).send({command:"WHO",params:t}),Xt(e)}},whois:{usage:"<nick>",description:"Retrieve information about a user",execute:(e,t)=>{let s=t[0];if(!s)throw new Error("Missing nick");Yt(e).send({command:"WHOIS",params:[s]}),Xt(e)}},whowas:{usage:"<nick> [count]",description:"Retrieve information about an offline user",execute:(e,t)=>{if(t.length<1)throw new Error("Missing nick");Yt(e).send({command:"WHOWAS",params:t}),Xt(e)}},list:{usage:"[filter]",description:"Retrieve a list of channels from a network",execute:(e,t)=>{Yt(e).send({command:"LIST",params:t}),Xt(e)}}};function ns(){let e=Qt.map((e=>{let t=[];return e.ctrlKey&&t.psuh("Ctrl"),e.altKey&&t.push("Alt"),t.push(e.key),t=t.map(((e,t)=>Ae`
				${t>0?"+":null}
				<kbd>${e}</kbd>
			`)),Ae`
			<dt>${t}</dt>
			<dd>${e.description}</dd>
		`}));return Ae`
		<dl>
			<dt><kbd>/</kbd></dt>
			<dd>Start writing a command</dd>

			${e}
		</dl>
	`}function rs(){let e=Object.keys(ss).map((e=>{let t=ss[e],s="/"+e;return t.usage&&(s+=" "+t.usage),Ae`
			<dt><strong><code>${s}</code></strong></dt>
			<dd>${t.description}</dd>
		`}));return Ae`<dl>${e}</dl>`}function as(){return Ae`
		<h3>Key bindings</h3>
		<${ns}/>

		<h3>Commands</h3>
		<${rs}/>
	`}const is={name:"",host:"",port:6697,nickname:"",username:"",realname:"",pass:""};class us extends f{prevParams=null;state={...is,autojoin:!0};constructor(e){super(e),this.prevParams={...is},this.handleChange=this.handleChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this),e.params&&Object.keys(is).forEach((t=>{void 0!==e.params[t]&&(this.state[t]=e.params[t],this.prevParams[t]=e.params[t])}))}handleChange(e){let t=e.target,s="checkbox"==t.type?t.checked:t.value;this.setState({[t.name]:s})}handleSubmit(e){e.preventDefault();let t={};Object.keys(is).forEach((e=>{(this.props.isNew||this.prevParams[e]!=this.state[e])&&(this.props.isNew&&is[e]==this.state[e]||(t[e]=this.state[e]))}));let s=this.state.autojoin?this.props.autojoin:null;this.props.onSubmit(t,s)}render(){let e=null;this.props.isNew||(e=Ae`
				<button type="button" class="danger" onClick=${()=>this.props.onRemove()}>
					Remove network
				</button>
			`);let t=null;return this.props.autojoin&&(t=Ae`
				<label>
					<input
						type="checkbox"
						name="autojoin"
						checked=${this.state.autojoin}
					/>
					Auto-join channel <strong>${this.props.autojoin}</strong>
				</label>
				<br/><br/>
			`),Ae`
			<form onChange=${this.handleChange} onSubmit=${this.handleSubmit}>
				<label>
					Hostname:<br/>
					<input type="text" name="host" value=${this.state.host} autofocus required/>
				</label>
				<br/><br/>

				${t}

				<details>
					<summary role="button">Advanced options</summary>

					<br/>

					<label>
						Port:<br/>
						<input type="number" name="port" value=${this.state.port}/>
					</label>
					<br/><br/>

					<label>
						Network name:<br/>
						<input type="text" name="name" value=${this.state.name}/>
					</label>
					<br/><br/>

					<label>
						Nickname:<br/>
						<input type="username" name="nickname" value=${this.state.nickname}/>
					</label>
					<br/><br/>

					<label>
						Username:<br/>
						<input type="username" name="username" value=${this.state.username}/>
					</label>
					<br/><br/>

					<label>
						Real name:<br/>
						<input type="text" name="realname" value=${this.state.realname}/>
					</label>
					<br/><br/>

					<label>
						Server password:<br/>
						<input type="password" name="pass" value=${this.state.pass} placeholder="None"/>
					</label>
					<br/>
				</details>

				<br/>
				${e}
				${" "}
				<button>
					${this.props.isNew?"Add network":"Save network"}
				</button>
			</form>
		`}}class os extends f{state={text:""};textInput={current:null};lastAutocomplete=null;constructor(e){super(e),this.handleInput=this.handleInput.bind(this),this.handleSubmit=this.handleSubmit.bind(this),this.handleInputKeyDown=this.handleInputKeyDown.bind(this),this.handleWindowKeyDown=this.handleWindowKeyDown.bind(this),this.handleWindowPaste=this.handleWindowPaste.bind(this)}handleInput(e){this.setState({[e.target.name]:e.target.value}),this.props.readOnly&&"text"===e.target.name&&!e.target.value&&e.target.blur()}handleSubmit(e){e.preventDefault(),this.props.onSubmit(this.state.text),this.setState({text:""})}handleInputKeyDown(e){let t=e.target;if(!this.props.autocomplete||"Tab"!==e.key)return;if(t.selectionStart!==t.selectionEnd)return;e.preventDefault();let s,n=t.selectionStart,r=this.state.text;if(this.lastAutocomplete&&this.lastAutocomplete.text===r&&this.lastAutocomplete.carretPos===n)s=this.lastAutocomplete;else{let e,a;for(this.lastAutocomplete=null,e=n-1;e>=0&&" "!==r[e];e--);for(e++,a=n;a<r.length&&" "!==r[a];a++);let i=r.slice(e,a);if(!i)return;let u=this.props.autocomplete(i);if(0===u.length)return;s={text:r,carretPos:t.selectionStart,prefix:r.slice(0,e),suffix:r.slice(a),replacements:u,replIndex:-1}}let a=s.replacements.length;e.shiftKey?s.replIndex--:s.replIndex++,s.replIndex=(s.replIndex+a)%a;let i=s.replacements[s.replIndex];s.prefix||s.suffix||(i.startsWith("/")?i+=" ":i+=": "),s.text=s.prefix+i+s.suffix,s.carretPos=s.prefix.length+i.length,t.value=s.text,t.selectionStart=s.carretPos,t.selectionEnd=t.selectionStart,this.lastAutocomplete=s,this.setState({text:s.text})}handleWindowKeyDown(e){document.activeElement!==document.body&&"SECTION"!==document.activeElement.tagName||e.altKey||e.ctrlKey||e.metaKey||1===[...e.key].length&&(this.state.text||this.props.readOnly&&"/"!==e.key||(e.preventDefault(),this.setState({text:e.key},(()=>{this.focus()}))))}handleWindowPaste(e){if(document.activeElement!==document.body&&"SECTION"!==document.activeElement.tagName)return;if(this.props.readOnly)return;if(!this.textInput.current)return;let t=e.clipboardData.getData("text");e.preventDefault(),e.stopImmediatePropagation(),this.textInput.current.focus(),this.textInput.current.setRangeText(t,void 0,void 0,"end"),this.setState({text:this.textInput.current.value})}componentDidMount(){window.addEventListener("keydown",this.handleWindowKeyDown),window.addEventListener("paste",this.handleWindowPaste)}componentWillUnmount(){window.removeEventListener("keydown",this.handleWindowKeyDown),window.removeEventListener("paste",this.handleWindowPaste)}focus(){this.textInput.current&&(document.activeElement.blur(),this.textInput.current.focus())}render(){let e="";return this.props.readOnly&&!this.state.text&&(e="read-only"),Ae`
			<form
				id="composer"
				class=${e}
				onInput=${this.handleInput}
				onSubmit=${this.handleSubmit}
			>
				<input
					type="text"
					name="text"
					ref=${this.textInput}
					value=${this.state.text}
					autocomplete="off"
					placeholder="Type a message"
					enterkeyhint="send"
					onKeyDown=${this.handleInputKeyDown}
				/>
			</form>
		`}}let ls=new Map;class cs extends f{constructor(e){super(e),this.handleScroll=this.handleScroll.bind(this)}isAtBottom(){let e=this.props.target.current;return e.scrollTop>=e.scrollHeight-e.offsetHeight}saveScrollPosition(){let e=this.props.target.current,t=e.querySelectorAll(this.props.stickTo),s=null;if(!this.isAtBottom())for(let n=0;n<t.length;n++){let r=t[n];if(r.offsetTop>=e.scrollTop+e.offsetTop){s=r.dataset.key;break}}ls.set(this.props.scrollKey,s)}restoreScrollPosition(){let e=this.props.target.current,t=ls.get(this.props.scrollKey);if(t){let s=e.querySelector('[data-key="'+t+'"]');s&&s.scrollIntoView()}else e.firstChild.scrollIntoView({block:"end"});0==e.scrollTop&&this.props.onScrollTop()}handleScroll(){0==this.props.target.current.scrollTop&&this.props.onScrollTop()}componentDidMount(){this.restoreScrollPosition(),this.props.target.current.addEventListener("scroll",this.handleScroll)}componentWillReceiveProps(e){this.props.scrollKey===e.scrollKey&&this.props.children===e.children||this.saveScrollPosition()}componentDidUpdate(e){this.props.target.current&&this.restoreScrollPosition()}componentWillUnmount(){this.props.target.current.removeEventListener("scroll",this.handleScroll),this.saveScrollPosition()}render(){return this.props.children}}class hs extends f{body={current:null};constructor(e){super(e),this.handleCloseClick=this.handleCloseClick.bind(this),this.handleBackdropClick=this.handleBackdropClick.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this)}dismiss(){this.props.onDismiss()}handleCloseClick(e){e.preventDefault(),this.dismiss()}handleBackdropClick(e){"dialog"==e.target.className&&this.dismiss()}handleKeyDown(e){"Escape"==e.key&&this.dismiss()}componentDidMount(){window.addEventListener("keydown",this.handleKeyDown);let e=this.body.current.querySelector("input[autofocus]");e&&e.focus()}componentWillUnmount(){window.removeEventListener("keydown",this.handleKeyDown)}render(){return Ae`
			<div class="dialog" onClick=${this.handleBackdropClick}>
				<div class="dialog-body" ref=${this.body}>
					<div class="dialog-header">
						<h2>${this.props.title}</h2>
						<button class="dialog-close" onClick=${this.handleCloseClick}>×</button>
					</div>
					${this.props.children}
				</div>
			</div>
		`}}const ps={server:{}},ms=fetch("./config.json").then((e=>e.ok?e.json():(404!==e.status&&console.error("Failed to fetch config: HTTP error:",e.status,e.statusText),{}))).catch((e=>(console.error("Failed to fetch config:",e),{}))).then((e=>({...ps,...e})));let ds=0;T(Ae`<${class extends f{state={...Dt.create(),connectParams:{url:null,pass:null,username:null,realname:null,nick:null,saslPlain:null,saslExternal:!1,autoconnect:!1,autojoin:[]},bouncerNetworks:new Map,connectForm:!0,loading:!0,dialog:null,dialogData:null,error:null,openPanels:{bufferList:!1,memberList:!1}};config={...ps};clients=new Map;endOfHistory=new Map;receipts=new Map;buffer={current:null};composer={current:null};switchToChannel=null;autoOpenURL=null;constructor(e){super(e),this.handleConnectSubmit=this.handleConnectSubmit.bind(this),this.handleJoinSubmit=this.handleJoinSubmit.bind(this),this.handleBufferListClick=this.handleBufferListClick.bind(this),this.handleBufferListClose=this.handleBufferListClose.bind(this),this.toggleBufferList=this.toggleBufferList.bind(this),this.toggleMemberList=this.toggleMemberList.bind(this),this.handleComposerSubmit=this.handleComposerSubmit.bind(this),this.handleChannelClick=this.handleChannelClick.bind(this),this.handleNickClick=this.handleNickClick.bind(this),this.autocomplete=this.autocomplete.bind(this),this.handleBufferScrollTop=this.handleBufferScrollTop.bind(this),this.dismissDialog=this.dismissDialog.bind(this),this.handleAddNetworkClick=this.handleAddNetworkClick.bind(this),this.handleNetworkSubmit=this.handleNetworkSubmit.bind(this),this.handleNetworkRemove=this.handleNetworkRemove.bind(this),this.handleDismissError=this.handleDismissError.bind(this),this.saveReceipts=function(e,t){let s=null;return(...n)=>{clearTimeout(s),s=setTimeout((()=>{s=null,e(...n)}),t)}}(this.saveReceipts.bind(this),500),this.receipts=vt.load(),this.bufferStore=new kt,ms.then((e=>(this.handleConfig(e),e)))}handleConfig(e){this.setState({loading:!1});let t={...this.state.connectParams};e.server&&("string"==typeof e.server.url&&(t.url=e.server.url),Array.isArray(e.server.autojoin)?t.autojoin=e.server.autojoin:"string"==typeof e.server.autojoin&&(t.autojoin=[e.server.autojoin]),"string"==typeof e.server.nick&&(t.nick=e.server.nick),"boolean"==typeof e.server.autoconnect&&(t.autoconnect=e.server.autoconnect),"external"===e.server.auth&&(t.saslExternal=!0));let s=bt.load();s&&(t={...t,...s,autoconnect:!0,autojoin:[]});let n=[],r=function(){let e=window.location.search.substring(1),t={};return e.split("&").forEach((e=>{if(!e)return;let s=e.split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1]||"")})),t}();"string"!=typeof r.server||t.url&&r.server||(t.url=r.server,e.server.auth=null),"string"==typeof r.nick&&(t.nick=r.nick),"string"==typeof r.channels&&(n=r.channels.split(",")),"string"==typeof r.open&&(this.autoOpenURL=Ke(r.open)),window.location.hash&&(n=window.location.hash.split(",")),this.config=e,n.length>0&&(t.autoconnect?this.autoOpenURL={host:"",entity:n[0]}:t.autojoin=n),this.setState({connectParams:t}),t.autoconnect&&(this.setState({connectForm:!1}),this.connect(t))}showError(e){return this.setState({error:e}),ds++,ds}dismissError(e){e&&e!==ds||this.setState({error:null})}handleDismissError(e){e.preventDefault(),this.dismissError()}setServerState(e,t,s){this.setState((s=>Dt.updateServer(s,e,t)),s)}setBufferState(e,t,s){this.setState((s=>Dt.updateBuffer(s,e,t)),s)}syncBufferUnread(e,t){let s=this.clients.get(e),n=this.bufferStore.get({name:t,server:s.params});s.enabledCaps["draft/chathistory"]&&n&&this.setBufferState({server:e,name:t},{unread:n.unread}),n||this.bufferStore.put({name:t,server:s.params,unread:st.NONE})}createBuffer(e,t){let s=this.clients.get(e),n=null,r=!1;return this.setState((a=>{let i;return[n,i]=Dt.createBuffer(a,t,e,s),r=!!i,i})),r&&this.syncBufferUnread(e,t),n}switchBuffer(e){let t;this.setState((s=>{if(t=Dt.getBuffer(s,e),t)return{activeBuffer:t.id}}),(()=>{if(!t)return;let e=this.getReceipt(t.name,rt);if(this.setBufferState(t.id,{unread:st.NONE,prevReadReceipt:e}),this.buffer.current&&this.buffer.current.focus(),t.messages.length>0){let e=t.messages[t.messages.length-1];this.setReceipt(t.name,rt,e);let s=this.clients.get(t.server);this.bufferStore.put({name:t.name,server:s.params,unread:st.NONE})}let s=this.state.servers.get(t.server);t.type!==et||s.users.has(t.name)||this.whoUserBuffer(t.name,t.server)}))}saveReceipts(){vt.put(this.receipts)}getReceipt(e,t){let s=this.receipts.get(e);if(s)return s[t]}hasReceipt(e,t,s){let n=this.getReceipt(e,t);return n&&s.tags.time<=n.time}setReceipt(e,t,s){this.getReceipt(e,t);this.hasReceipt(e,t,s)||(this.receipts.set(e,{...this.receipts.get(e),[t]:{time:s.tags.time}}),this.saveReceipts())}latestReceipt(e){let t=null;return this.receipts.forEach(((s,n)=>{if("*"===n)return;let r=s[e];r&&r.time&&(!t||r.time>t.time)&&(t=r)})),t}addMessage(e,t,s){let n=this.clients.get(e);s.isHighlight=function(e,t,s){if("PRIVMSG"!=e.command&&"NOTICE"!=e.command)return!1;if(t=s(t),e.prefix&&s(e.prefix.name)==t)return!1;let n=s(e.params[1]);for(;;){let e=n.indexOf(t);if(e<0)return!1;let s="\0",r="\0";if(e>0&&(s=n[e-1]),e<n.length&&(r=n[e+t.length]),Te(s)&&Te(r))return!0;n=n.slice(e+t.length)}}(s,n.nick,n.cm)||function(e){return("PRIVMSG"==e.command||"NOTICE"==e.command)&&e.params[0].startsWith("$")}(s),s.tags||(s.tags={}),s.tags.time||(s.tags.time=$e(new Date));let r=this.hasReceipt(t,nt,s),a=this.hasReceipt(t,rt,s);n.isMyNick(s.prefix.name)&&(a=!0);let i=st.NONE;if(("PRIVMSG"==s.command||"NOTICE"==s.command)&&!a){let a,u=s.params[0],o=s.params[1];if(s.isHighlight?(i=st.HIGHLIGHT,a="highlight"):n.isMyNick(u)?(i=st.HIGHLIGHT,a="private message"):i=st.MESSAGE,i==st.HIGHLIGHT&&!r&&!Re(s)){let r="New "+a+" from "+s.prefix.name;n.isChannel(t)&&(r+=" in "+t);let i=function(e,t){if(!window.Notification||"granted"!==Notification.permission)return new EventTarget;try{return new Notification(e,t)}catch(e){return console.error("Failed to show notification: ",e),new EventTarget}}(r,{body:Ve(o),requireInteraction:!0,tag:"msg,"+s.prefix.name+","+t});i.addEventListener("click",(()=>{this.switchBuffer({server:e,name:t})}))}}if("INVITE"===s.command&&n.isMyNick(s.params[0])){i=st.HIGHLIGHT;let n=s.params[1];new Notification("Invitation to "+n,{body:s.prefix.name+" has invited you to "+n,requireInteraction:!0,tag:"invite,"+s.prefix.name+","+n,actions:[{action:"accept",title:"Accept"}]}).addEventListener("click",(r=>{"accept"===r.action?(this.setReceipt(t,rt,s),this.open(n,e)):this.switchBuffer({server:e,name:t})}))}n.isMyNick(s.prefix.name)&&!n.isMyNick(t)||"PART"==s.command||"QUIT"==s.comand||this.createBuffer(e,t),this.setReceipt(t,nt,s);let u={server:e,name:t};this.setState((e=>Dt.addMessage(e,s,u))),this.setBufferState(u,(e=>{let r=e.unread,a=e.prevReadReceipt;return this.state.activeBuffer!==e.id?r=st.union(r,i):this.setReceipt(t,rt,s),n.isMyNick(s.prefix.name)&&(a={time:s.tags.time}),this.bufferStore.put({name:e.name,server:n.params,unread:r}),{unread:r,prevReadReceipt:a}}))}connect(e){let t=null;this.setState((e=>{let s;return[t,s]=Dt.createServer(e),s})),this.setState({connectParams:e});let s=new Qe(function(e){let t=window.location.host||"localhost:8080",s="wss:";"https:"!=window.location.protocol&&(s="ws:");let n=window.location.pathname||"/";return window.location.host||(n="/"),(e={...e}).url||(e.url=s+"//"+t+n+"socket"),e.url.startsWith("/")&&(e.url=s+"//"+t+e.url),e.url.indexOf("://")<0&&(e.url=s+"//"+e.url),e.username||(e.username=e.nick),e.realname||(e.realname=e.nick),e}(e));this.clients.set(t,s),this.setServerState(t,{status:s.status});let n=null;s.addEventListener("status",(()=>{this.setServerState(t,{status:s.status}),s.status===Qe.Status.REGISTERED&&(this.setState({connectForm:!1}),n&&this.dismissError(n))})),s.addEventListener("message",(e=>{this.handleMessage(t,e.detail.message)})),s.addEventListener("error",(e=>{n=this.showError(e.detail)})),this.createBuffer(t,"*"),this.state.activeBuffer||this.switchBuffer({server:t,name:"*"}),e.autojoin.length>0&&(this.switchToChannel=e.autojoin[0]),this.config.server&&void 0!==this.config.server.ping&&s.setPingInterval(this.config.server.ping)}disconnect(e){e||(e=Dt.getActiveServerID(this.state));let t=this.clients.get(e);t&&(this.clients.delete(e),t.disconnect())}reconnect(e){e||(e=Dt.getActiveServerID(this.state));let t=this.clients.get(e);t&&t.reconnect()}serverFromBouncerNetwork(e){for(let[t,s]of this.clients)if(s.params.bouncerNetwork===e)return t;return null}routeMessage(e,t){let s,n,r,a=this.clients.get(e),i=He(t,"chathistory");switch(t.command){case"MODE":return s=t.params[0],a.isChannel(s)?[s]:["*"];case"NOTICE":case"PRIVMSG":s=t.params[0],a.isMyNick(s)&&(s=a.cm(t.prefix.name)===a.cm(a.serverPrefix.name)?"*":t.prefix.name),"NOTICE"!==t.command||Dt.getBuffer(this.state,{server:e,name:s})||(s="*");let u=a.isupport.get("STATUSMSG");if(u){let e=Oe(s,u);a.isChannel(e.name)&&(s=e.name)}return[s];case"JOIN":return n=t.params[0],a.isMyNick(t.prefix.name)?[]:[n];case"PART":case"KICK":case"TOPIC":return n=t.params[0],[n];case"QUIT":return r=[],i?r.push(i.params[0]):this.state.buffers.forEach((s=>{s.server==e&&(s.members.has(t.prefix.name)||a.cm(s.name)===a.cm(t.prefix.name))&&r.push(s.name)})),r;case"NICK":let o=t.params[0];return r=[],i?r.push(i.params[0]):(this.state.buffers.forEach((s=>{s.server==e&&s.members.has(t.prefix.name)&&r.push(s.name)})),a.isMyNick(o)&&r.push("*")),r;case"INVITE":n=t.params[1];let l=n;return Dt.getBuffer(this.state,{server:e,name:n})||(l="*"),[l];case"324":case"329":case"346":case"347":case"348":case"349":case"367":case"368":case"728":case"729":return n=t.params[1],[n];case"341":return n=t.params[2],[n];case"002":case"004":case"005":case"376":case"422":case"331":case"332":case"333":case"353":case"366":case"730":case"731":case"903":case"AWAY":case"SETNAME":case"CHGHOST":case"ACCOUNT":case"CAP":case"AUTHENTICATE":case"PING":case"PONG":case"BATCH":case"TAGMSG":case"CHATHISTORY":case"ACK":case"BOUNCER":return[];default:return["*"]}}handleMessage(e,t){let s,n=this.clients.get(e),r=this.routeMessage(e,t);if(He(t,"chathistory"))r.forEach((s=>{this.addMessage(e,s,t)}));else{switch(this.setState((s=>Dt.handleMessage(s,t,e,n))),t.command){case"001":let r=this.latestReceipt(nt);if(r&&r.time&&n.enabledCaps["draft/chathistory"]&&(!n.enabledCaps["soju.im/bouncer-networks"]||n.params.bouncerNetwork)){let e=$e(new Date);n.fetchHistoryTargets(e,r.time).then((s=>{s.forEach((s=>{let a=r,i={time:t.tags.time||e};this.fetchBacklog(n,s.name,a,i)}))}))}break;case"376":case"422":let a=[];for(let t of this.bufferStore.list(n.params))if("*"!==t.name)if(n.isChannel(t.name)){if(n.enabledCaps["soju.im/bouncer-networks"])continue;a.push(t.name)}else this.createBuffer(e,t.name),this.whoUserBuffer(t.name,e);let i=this.state.servers.get(e).isupport.get("BOUNCER_NETID"),u=null;i&&(u=this.state.bouncerNetworks.get(i)),u&&"connected"!==u.state||(a=a.concat(n.params.autojoin),n.params.autojoin=[]),a.length>0&&n.send({command:"JOIN",params:[a.join(",")]});let o=u?u.host:"";this.autoOpenURL&&o===this.autoOpenURL.host&&(this.openURL(this.autoOpenURL),this.autoOpenURL=null);case"JOIN":s=t.params[0],n.isMyNick(t.prefix.name)&&this.syncBufferUnread(e,s),s==this.switchToChannel&&(this.switchBuffer({server:e,name:s}),this.switchToChannel=null);break;case"PART":s=t.params[0],n.isMyNick(t.prefix.name)&&(this.receipts.delete(s),this.saveReceipts());break;case"BOUNCER":if("NETWORK"!==t.params[0])break;if(n.isupport.has("BOUNCER_NETID"))break;let l=t.params[1],c=null;"*"!==t.params[2]&&(c=Se(t.params[2]));let h=!1;this.setState((e=>{let t=new Map(e.bouncerNetworks);if(c){let e=t.get(l);h=void 0===e,c={...e,...c},t.set(l,c)}else t.delete(l);return{bouncerNetworks:t}}),(()=>{if(c)h&&this.connect({...n.params,bouncerNetwork:l});else{let e=this.serverFromBouncerNetwork(l);e&&this.close({server:e,name:"*"})}if(c&&"connected"===c.state){let e=this.serverFromBouncerNetwork(l),t=this.clients.get(e);t&&t.status===Qe.Status.REGISTERED&&t.params.autojoin&&t.params.autojoin.length>0&&(t.send({command:"JOIN",params:[t.params.autojoin.join(",")]}),t.params.autojoin=[])}}));break;case"BATCH":if(!t.params[0].startsWith("-"))break;let p=t.params[0].slice(1),m=n.batches.get(p);if(!m||"soju.im/bouncer-networks"!==m.type)break;this.autoOpenURL&&this.autoOpenURL.host&&!this.findBouncerNetIDByHost(this.autoOpenURL.host)&&(this.openURL(this.autoOpenURL),this.autoOpenURL=null);break;default:if(xe(t.command)&&"422"!=t.command){let e=t.params[t.params.length-1];this.showError(e)}}r.forEach((s=>{this.addMessage(e,s,t)}))}}handleConnectSubmit(e){this.dismissError(),e.autoconnect?bt.put(e):bt.put(null);let t=this.state.buffers.get(this.state.activeBuffer);t&&this.close(t.server),this.connect(e)}handleChannelClick(e){this.openURL(e.target.href)&&e.preventDefault()}findBouncerNetIDByHost(e){for(let[t,s]of this.state.bouncerNetworks)if(s.host===e)return t;return null}openURL(e){if("string"==typeof e&&(e=Ke(e)),!e)return!1;let t,{host:s,port:n}=function(e){let t=e,s=null,n=e.lastIndexOf(":");return n>0&&!e.endsWith("]")&&(t=e.slice(0,n),s=parseInt(e.slice(n+1),10)),t.startsWith("[")&&t.endsWith("]")&&(t=t.slice(1,t.length-1)),{host:t,port:s}}(e.host);if(e.host){let r=this.findBouncerNetIDByHost(s);if(!r){let t=this.clients.values().next().value;if(!t||!t.enabledCaps["soju.im/bouncer-networks"])return!1;let r={host:s};return"number"==typeof n&&(r.port=n),this.openDialog("network",{params:r,autojoin:e.entity}),!0}for(let[e,s]of this.state.servers)if(s.isupport.get("BOUNCER_NETID")===r){t=e;break}}else t=Dt.getActiveServerID(this.state);if(!t)return!1;let r=Dt.getBuffer(this.state,{server:t,name:e.entity||"*"});return r?this.switchBuffer(r.id):this.openDialog("join",{server:t,channel:e.entity}),!0}handleNickClick(e){this.open(e)}fetchBacklog(e,t,s,n){e.fetchHistoryBetween(t,s,n,4e3).catch((e=>{console.error("Failed to fetch backlog for '"+t+"': ",e),this.showError("Failed to fetch backlog for '"+t+"'"),this.receipts.delete(t),this.saveReceipts()}))}whoUserBuffer(e,t){let s=this.clients.get(t);s.who(e,{fields:["flags","hostname","nick","realname","username","account"]}),s.monitor(e)}open(e,t){t||(t=Dt.getActiveServerID(this.state));let s=this.clients.get(t);s.isServer(e)?this.switchBuffer({server:t}):s.isChannel(e)?(this.switchToChannel=e,s.send({command:"JOIN",params:[e]})):(this.whoUserBuffer(e,t),this.createBuffer(t,e),this.switchBuffer({server:t,name:e}))}close(e){let t=Dt.getBuffer(this.state,e);if(!t)return;let s=this.clients.get(t.server);switch(t.type){case Xe:this.setState((e=>{let s=new Map(e.buffers);for(let[n,r]of e.buffers)r.server===t.server&&s.delete(n);let n=e.activeBuffer;return n&&e.buffers.get(n).server===t.server&&(n=s.size>0?s.keys().next().value:null),{buffers:s,activeBuffer:n}}));let e=s&&!s.params.bouncerNetwork&&s.enabledCaps["soju.im/bouncer-networks"];if(this.disconnect(t.server),this.setState((e=>{let s=new Map(e.servers);s.delete(t.server);let n=e.connectForm;return 0==s.size&&(n=!0),{servers:s,connectForm:n}})),e){for(let e of this.clients.keys())this.close({server:e,name:"*"});this.bufferStore.clear()}else this.bufferStore.clear(s.params);1==t.server&&bt.put(null);break;case Ze:t.joined&&s.send({command:"PART",params:[t.name]});case et:this.switchBuffer({name:"*"}),this.setState((e=>{let s=new Map(e.buffers);return s.delete(t.id),{buffers:s}})),s.unmonitor(t.name),this.receipts.delete(t.name),this.saveReceipts(),this.bufferStore.delete({name:t.name,server:s.params})}}executeCommand(e){let t=e.split(" "),s=t[0].toLowerCase().slice(1),n=t.slice(1),r=ss[s];if(r)try{r.execute(this,n)}catch(e){console.error(`Failed to execute command "${s}":`,e),this.showError(e.message)}else this.showError(`Unknown command "${s}" (run "/help" to get a command list)`)}privmsg(e,t){if("*"==e)return void this.showError("Cannot send message in server buffer");let s=Dt.getActiveServerID(this.state),n=this.clients.get(s),r={command:"PRIVMSG",params:[e,t]};n.send(r),n.enabledCaps["echo-message"]||(r.prefix={name:n.nick},this.addMessage(s,e,r))}handleComposerSubmit(e){if(!e)return;if(e.startsWith("//"))e=e.slice(1);else if(e.startsWith("/"))return void this.executeCommand(e);let t=this.state.buffers.get(this.state.activeBuffer);t&&this.privmsg(t.name,e)}handleBufferListClick(e){this.switchBuffer(e),this.closeBufferList()}handleBufferListClose(e){this.close(e),this.closeBufferList()}toggleBufferList(){this.setState((e=>({openPanels:{...e.openPanels,bufferList:!e.openPanels.bufferList}})))}toggleMemberList(){this.setState((e=>({openPanels:{...e.openPanels,memberList:!e.openPanels.memberList}})))}closeBufferList(){this.setState((e=>({openPanels:{...e.openPanels,bufferList:!1}})))}closeMemberList(){this.setState((e=>({openPanels:{...e.openPanels,memberList:!1}})))}handleJoinClick(e){switch(e.type){case Xe:this.openDialog("join",{server:e.server});break;case Ze:this.clients.get(e.server).send({command:"JOIN",params:[e.name]})}}handleJoinSubmit(e){this.open(e.channel,this.state.dialogData.server),this.dismissDialog()}autocomplete(e){function t(e,t){t=t.toLowerCase();let s=[];for(let n of e)n.toLowerCase().startsWith(t)&&s.push(n);return s}if(e.startsWith("/")){return t(Object.keys(ss),e.slice(1)).map((e=>"/"+e))}if(e.startsWith("#")){let s=[];for(const e of this.state.buffers.values())e.name.startsWith("#")&&s.push(e.name);return t(s,e)}let s=this.state.buffers.get(this.state.activeBuffer);return s&&s.members?t(s.members.keys(),e):[]}openHelp(){this.openDialog("help")}handleBufferScrollTop(){let e=this.state.buffers.get(this.state.activeBuffer);if(!e||e.type==Xe)return;let t,s=this.clients.get(e.server);if(!s||!s.enabledCaps["draft/chathistory"]||!s.enabledCaps["server-time"])return;if(this.endOfHistory.get(e.id))return;t=e.messages.length>0?e.messages[0].tags.time:$e(new Date),this.endOfHistory.set(e.id,!0);let n=100;s.enabledCaps["draft/event-playback"]&&(n=200),s.fetchHistoryBefore(e.name,t,n).then((t=>{this.endOfHistory.set(e.id,!t.more)}))}openDialog(e,t){this.setState({dialog:e,dialogData:t})}dismissDialog(){this.setState({dialog:null,dialogData:null})}handleAddNetworkClick(){this.openDialog("network")}handleManageNetworkClick(e){let t=this.state.servers.get(e).isupport.get("BOUNCER_NETID"),s=this.state.bouncerNetworks.get(t);this.openDialog("network",{id:t,params:s})}handleNetworkSubmit(e,t){let s=this.clients.values().next().value;if(this.state.dialogData&&this.state.dialogData.id){if(0==Object.keys(e).length)return void this.dismissDialog();s.send({command:"BOUNCER",params:["CHANGENETWORK",this.state.dialogData.id,Fe(e)]})}else e={...e,tls:"1"},s.createBouncerNetwork(e).then((e=>{if(!t)return;let s=this.serverFromBouncerNetwork(e);this.clients.get(s).params.autojoin=[t],this.switchToChannel=t}));this.dismissDialog()}handleNetworkRemove(){this.clients.values().next().value.send({command:"BOUNCER",params:["DELNETWORK",this.state.dialogData.id]}),this.dismissDialog()}componentDidMount(){!function(e){let t={};Qt.forEach((e=>{t[e.key]||(t[e.key]=[]),t[e.key].push(e)})),window.addEventListener("keydown",(s=>{let n=t[s.key];n&&(n=n.filter((e=>!!e.altKey==s.altKey&&!!e.ctrlKey==s.ctrlKey)),1==n.length&&(s.preventDefault(),n[0].execute(e)))}))}(this)}render(){if(this.state.loading)return Ae`<section id="connect"></section>`;let e=null,t=null,s=null,n=!1;if(this.state.buffers.get(this.state.activeBuffer)){e=this.state.buffers.get(this.state.activeBuffer),t=this.state.servers.get(e.server);let r=this.clients.get(e.server);n=r&&r.enabledCaps["soju.im/bouncer-networks"];let a=t.isupport.get("BOUNCER_NETID");a&&(s=this.state.bouncerNetworks.get(a))}if(this.state.connectForm){let e=t?t.status:tt.DISCONNECTED,s=e===tt.CONNECTING||e===tt.REGISTERING;return Ae`
				<section id="connect">
					<${Gt}
						error=${this.state.error}
						params=${this.state.connectParams}
						auth=${this.config.server.auth}
						connecting=${s}
						onSubmit=${this.handleConnectSubmit}
					/>
				</section>
			`}let r=null;if(e){let a=null;e.type==et&&(a=t.users.get(e.name)),r=Ae`
				<section id="buffer-header">
					<${Ht}
						buffer=${e}
						server=${t}
						user=${a}
						isBouncer=${n}
						bouncerNetwork=${s}
						onChannelClick=${this.handleChannelClick}
						onClose=${()=>this.close(e)}
						onJoin=${()=>this.handleJoinClick(e)}
						onAddNetwork=${this.handleAddNetworkClick}
						onManageNetwork=${()=>this.handleManageNetworkClick(e.server)}
					/>
				</section>
			`}let a=null;e&&e.type==Ze&&(a=Ae`
				<section
						id="member-list"
						class=${this.state.openPanels.memberList?"expand":""}
				>
					<button
						class="expander"
						onClick=${this.toggleMemberList}
					>
						<span></span>
						<span></span>
					</button>
					<section>
						<section id="member-list-header">
							${e.members.size} users
						</section>
						<${Wt}
							members=${e.members}
							users=${t.users}
							onNickClick=${this.handleNickClick}
						/>
					</section>
				</section>
			`);let i=null,u=this.state.dialogData||{};switch(this.state.dialog){case"network":let e=!u.id;i=Ae`
				<${hs} title=${e?"Add network":"Edit network"} onDismiss=${this.dismissDialog}>
					<${us}
						onSubmit=${this.handleNetworkSubmit}
						onRemove=${this.handleNetworkRemove}
						params=${u.params}
						autojoin=${u.autojoin}
						isNew=${e}
					/>
				</>
			`;break;case"help":i=Ae`
				<${hs} title="Help" onDismiss=${this.dismissDialog}>
					<${as}/>
				</>
			`;break;case"join":i=Ae`
				<${hs} title="Join channel" onDismiss=${this.dismissDialog}>
					<${zt} channel=${u.channel} onSubmit=${this.handleJoinSubmit}/>
				</>
			`}let o=null;this.state.error&&(o=Ae`
				<div id="error-msg">
					${this.state.error}
					${" "}
					<button onClick=${this.handleDismissError}>×</button>
				</div>
			`);let l=!1;return e&&e.type===Xe&&(l=!0),t&&t.status!==tt.REGISTERED&&(l=!0),Ae`
			<section
					id="buffer-list"
					class=${this.state.openPanels.bufferList?"expand":""}
			>
				<${It}
					buffers=${this.state.buffers}
					servers=${this.state.servers}
					bouncerNetworks=${this.state.bouncerNetworks}
					isBouncer=${n}
					activeBuffer=${this.state.activeBuffer}
					onBufferClick=${this.handleBufferListClick}
					onBufferClose=${this.handleBufferListClose}
				/>
				<button
					class="expander"
					onClick=${this.toggleBufferList}
				>
					<span></span>
					<span></span>
				</button>
			</section>
			${r}
			<${cs}
				target=${this.buffer}
				stickTo=".logline"
				scrollKey=${this.state.activeBuffer}
				onScrollTop=${this.handleBufferScrollTop}
			>
				<section id="buffer" ref=${this.buffer} tabindex="-1">
					<${$t}
						buffer=${e}
						server=${t}
						isBouncer=${n}
						onChannelClick=${this.handleChannelClick}
						onNickClick=${this.handleNickClick}/>
				</section>
			</>
			${a}
			<${os}
				ref=${this.composer}
				readOnly=${l}
				onSubmit=${this.handleComposerSubmit}
				autocomplete=${this.autocomplete}
			/>
			${i}
			${o}
		`}}}/>`,document.body);
//# sourceMappingURL=index.d445c23a.js.map
